`);c.write(s.format.apply(s,A))}}P(x,"warn"),Object.defineProperty(e.exports,"isWin",{get:P(function(){return a},"get"),set:P(function(D){a=D},"set")}),e.exports.warnTo=function(D){var A=c;return c=D,A},e.exports.getFileName=function(D){var A=D||je.env,R=A.PGPASSFILE||(a?n.join(A.APPDATA||"./","postgresql","pgpass.conf"):n.join(A.HOME||"./",".pgpass"));return R},e.exports.usePgPass=function(D,A){return Object.prototype.hasOwnProperty.call(je.env,"PGPASSWORD")?!1:a?!0:(A=A||"<unkn>",b(D.mode)?D.mode&(l|u)?(x('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',A),!1):!0:(x('WARNING: password file "%s" is not a plain file',A),!1))};var C=e.exports.match=function(D,A){return y.slice(0,-1).reduce(function(R,q,k){return k==1&&Number(D[q]||o)===Number(A[q])?R&&!0:R&&(A[q]==="*"||A[q]===D[q])},!0)};e.exports.getPassword=function(D,A,R){var q,k=A.pipe(i());function z(ae){var Q=T(ae);Q&&N(Q)&&C(D,Q)&&(q=Q[_],k.end())}P(z,"onLine");var V=P(function(){A.destroy(),R(q)},"onEnd"),re=P(function(ae){A.destroy(),x("WARNING: error on reading file: %s",ae),R(void 0)},"onErr");A.on("error",re),k.on("data",z).on("end",V).on("error",re)};var T=e.exports.parseLine=function(D){if(D.length<11||D.match(/^\s+#/))return null;for(var A="",R="",q=0,k=0,z=0,V={},re=!1,ae=P(function(ce,fe,me){var Me=D.substring(fe,me);Object.hasOwnProperty.call(je.env,"PGPASS_NO_DEESCAPE")||(Me=Me.replace(/\\([:\\])/g,"$1")),V[y[ce]]=Me},"addToObj"),Q=0;Q<D.length-1;Q+=1){if(A=D.charAt(Q+1),R=D.charAt(Q),re=q==g-1,re){ae(q,k);break}Q>=0&&A==":"&&R!=="\\"&&(ae(q,k,Q+1),k=Q+2,q+=1)}return V=Object.keys(V).length===g?V:null,V},N=e.exports.isValidEntry=function(D){for(var A={0:function(V){return V.length>0},1:function(V){return V==="*"?!0:(V=Number(V),isFinite(V)&&V>0&&V<9007199254740992&&Math.floor(V)===V)},2:function(V){return V.length>0},3:function(V){return V.length>0},4:function(V){return V.length>0}},R=0;R<y.length;R+=1){var q=A[R],k=D[y[R]]||"",z=q(k);if(!z)return!1}return!0}}),Fne=We((t,e)=>{"use strict";Pe();var n=(V8(),sn(T_)),r=(W8(),sn(C_)),i=Lne();e.exports=function(s,o){var a=i.getFileName();r.stat(a,function(c,l){if(c||!i.usePgPass(l,a))return o(void 0);var u=r.createReadStream(a);i.getPassword(s,u,o)})},e.exports.warnTo=i.warnTo}),I_=We((t,e)=>{"use strict";Pe();var n=_h();function r(i){this._types=i||n,this.text={},this.binary={}}P(r,"TypeOverrides"),r.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},r.prototype.setTypeParser=function(i,s,o){typeof s=="function"&&(o=s,s="text"),this.getOverrides(s)[i]=o},r.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=r}),X8={};Gr(X8,{default:()=>Z8});var Z8,Une=zn(()=>{"use strict";Pe(),Z8={}}),e4={};Gr(e4,{parse:()=>P_});function P_(t,e=!1){let{protocol:n}=new URL(t),r="http:"+t.substring(n.length),{username:i,password:s,host:o,hostname:a,port:c,pathname:l,search:u,searchParams:p,hash:h}=new URL(r);s=decodeURIComponent(s),i=decodeURIComponent(i),l=decodeURIComponent(l);let b=i+":"+s,y=e?Object.fromEntries(p.entries()):u;return{href:t,protocol:n,auth:b,username:i,password:s,host:o,hostname:a,port:c,pathname:l,search:u,query:y,hash:h}}var t4=zn(()=>{"use strict";Pe(),P(P_,"parse")}),Bne=We((t,e)=>{"use strict";Pe();var n=(t4(),sn(e4)),r=(W8(),sn(C_));function i(s){if(s.charAt(0)==="/"){var a=s.split(" ");return{host:a[0],database:a[1]}}var o=n.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),a=o.query;for(var c in a)Array.isArray(a[c])&&(a[c]=a[c][a[c].length-1]);var l=(o.auth||":").split(":");if(a.user=l[0],a.password=l.splice(1).join(":"),a.port=o.port,o.protocol=="socket:")return a.host=decodeURI(o.pathname),a.database=o.query.db,a.client_encoding=o.query.encoding,a;a.host||(a.host=o.hostname);var u=o.pathname;if(!a.host&&u&&/^%2f/i.test(u)){var p=u.split("/");a.host=decodeURIComponent(p[0]),u=p.splice(1).join("/")}switch(u&&u.charAt(0)==="/"&&(u=u.slice(1)||null),a.database=u&&decodeURI(u),(a.ssl==="true"||a.ssl==="1")&&(a.ssl=!0),a.ssl==="0"&&(a.ssl=!1),(a.sslcert||a.sslkey||a.sslrootcert||a.sslmode)&&(a.ssl={}),a.sslcert&&(a.ssl.cert=r.readFileSync(a.sslcert).toString()),a.sslkey&&(a.ssl.key=r.readFileSync(a.sslkey).toString()),a.sslrootcert&&(a.ssl.ca=r.readFileSync(a.sslrootcert).toString()),a.sslmode){case"disable":{a.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{a.ssl.rejectUnauthorized=!1;break}}return a}P(i,"parse"),e.exports=i,i.parse=i}),k_=We((t,e)=>{"use strict";Pe();var n=(Une(),sn(X8)),r=xh(),i=Bne().parse,s=P(function(p,h,b){return b===void 0?b=je.env["PG"+p.toUpperCase()]:b===!1||(b=je.env[b]),h[p]||b||r[p]},"val"),o=P(function(){switch(je.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return r.ssl},"readSSLConfigFromEnvironment"),a=P(function(p){return"'"+(""+p).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=P(function(p,h,b){var y=h[b];y!=null&&p.push(b+"="+a(y))},"add"),l=class{constructor(h){h=typeof h=="string"?i(h):h||{},h.connectionString&&(h=Object.assign({},h,i(h.connectionString))),this.user=s("user",h),this.database=s("database",h),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",h),10),this.host=s("host",h),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",h)}),this.binary=s("binary",h),this.options=s("options",h),this.ssl=typeof h.ssl>"u"?o():h.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",h),this.replication=s("replication",h),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",h,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",h,!1),this.statement_timeout=s("statement_timeout",h,!1),this.lock_timeout=s("lock_timeout",h,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",h,!1),this.query_timeout=s("query_timeout",h,!1),h.connectionTimeoutMillis===void 0?this.connect_timeout=je.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(h.connectionTimeoutMillis/1e3),h.keepAlive===!1?this.keepalives=0:h.keepAlive===!0&&(this.keepalives=1),typeof h.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(h.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(h){var b=[];c(b,this,"user"),c(b,this,"password"),c(b,this,"port"),c(b,this,"application_name"),c(b,this,"fallback_application_name"),c(b,this,"connect_timeout"),c(b,this,"options");var y=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(b,y,"sslmode"),c(b,y,"sslca"),c(b,y,"sslkey"),c(b,y,"sslcert"),c(b,y,"sslrootcert"),this.database&&b.push("dbname="+a(this.database)),this.replication&&b.push("replication="+a(this.replication)),this.host&&b.push("host="+a(this.host)),this.isDomainSocket)return h(null,b.join(" "));this.client_encoding&&b.push("client_encoding="+a(this.client_encoding)),n.lookup(this.host,function(g,_){return g?h(g,null):(b.push("hostaddr="+a(_)),h(null,b.join(" ")))})}};P(l,"ConnectionParameters");var u=l;e.exports=u}),$ne=We((t,e)=>{"use strict";Pe();var n=_h(),r=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(a,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=a==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(a){var c;a.text?c=r.exec(a.text):c=r.exec(a.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(a){for(var c=new Array(a.length),l=0,u=a.length;l<u;l++){var p=a[l];p!==null?c[l]=this._parsers[l](p):c[l]=null}return c}parseRow(a){for(var c={},l=0,u=a.length;l<u;l++){var p=a[l],h=this.fields[l].name;p!==null?c[h]=this._parsers[l](p):c[h]=null}return c}addRow(a){this.rows.push(a)}addFields(a){this.fields=a,this.fields.length&&(this._parsers=new Array(a.length));for(var c=0;c<a.length;c++){var l=a[c];this._types?this._parsers[c]=this._types.getTypeParser(l.dataTypeID,l.format||"text"):this._parsers[c]=n.getTypeParser(l.dataTypeID,l.format||"text")}}};P(i,"Result");var s=i;e.exports=s}),Gne=We((t,e)=>{"use strict";Pe();var{EventEmitter:n}=Do(),r=$ne(),i=Sh(),s=class extends n{constructor(c,l,u){super(),c=i.normalizeQueryConfig(c,l,u),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,je.domain&&c.callback&&(this.callback=je.domain.bind(c.callback)),this._result=new r(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new r(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let l;if(!this._canceledDueToError){try{l=this._result.parseRow(c.fields)}catch(u){this._canceledDueToError=u;return}this.emit("row",l,this._result),this._accumulateRows&&this._result.addRow(l)}}handleCommandComplete(c,l){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&l.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,l){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(l){je.nextTick(()=>{throw l})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let l=c.parsedStatements[this.name];return this.text&&l&&this.text!==l?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,l){c.execute({portal:this.portal,rows:l}),l?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(l){this.handleError(l,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,l){}};P(s,"Query");var o=s;e.exports=o}),n4={};Gr(n4,{Socket:()=>Ec,isIP:()=>r4});function r4(t){return 0}var N8,w_,Wu,Ec,R_=zn(()=>{"use strict";Pe(),N8=Sc(Do(),1),P(r4,"isIP"),w_=/^[^.]+\./,Wu=class qe extends N8.EventEmitter{constructor(){super(...arguments),$e(this,"opts",{}),$e(this,"connecting",!1),$e(this,"pending",!0),$e(this,"writable",!0),$e(this,"encrypted",!1),$e(this,"authorized",!1),$e(this,"destroyed",!1),$e(this,"ws",null),$e(this,"writeBuffer"),$e(this,"tlsState",0),$e(this,"tlsRead"),$e(this,"tlsWrite")}static get poolQueryViaFetch(){return qe.opts.poolQueryViaFetch??qe.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){qe.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return qe.opts.fetchEndpoint??qe.defaults.fetchEndpoint}static set fetchEndpoint(e){qe.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return qe.opts.fetchFunction??qe.defaults.fetchFunction}static set fetchFunction(e){qe.opts.fetchFunction=e}static get webSocketConstructor(){return qe.opts.webSocketConstructor??qe.defaults.webSocketConstructor}static set webSocketConstructor(e){qe.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??qe.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return qe.opts.wsProxy??qe.defaults.wsProxy}static set wsProxy(e){qe.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??qe.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return qe.opts.coalesceWrites??qe.defaults.coalesceWrites}static set coalesceWrites(e){qe.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??qe.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return qe.opts.useSecureWebSocket??qe.defaults.useSecureWebSocket}static set useSecureWebSocket(e){qe.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??qe.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return qe.opts.forceDisablePgSSL??qe.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){qe.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??qe.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return qe.opts.disableSNI??qe.defaults.disableSNI}static set disableSNI(e){qe.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??qe.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return qe.opts.pipelineConnect??qe.defaults.pipelineConnect}static set pipelineConnect(e){qe.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??qe.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return qe.opts.subtls??qe.defaults.subtls}static set subtls(e){qe.opts.subtls=e}get subtls(){return this.opts.subtls??qe.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return qe.opts.pipelineTLS??qe.defaults.pipelineTLS}static set pipelineTLS(e){qe.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??qe.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return qe.opts.rootCerts??qe.defaults.rootCerts}static set rootCerts(e){qe.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??qe.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,n){let r=this.wsProxy;if(r===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof r=="function"?r(e,n):`${r}?address=${e}:${n}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,n,r){this.connecting=!0,r&&this.once("connect",r);let i=P(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=P((a,c=!1)=>{a.binaryType="arraybuffer",a.addEventListener("error",l=>{this.emit("error",l),this.emit("close")}),a.addEventListener("message",l=>{if(this.tlsState===0){let u=Ue.from(l.data);this.emit("data",u)}}),a.addEventListener("close",()=>{this.emit("close")}),c?i():a.addEventListener("open",i)},"configureWebSocket"),o;try{o=this.wsProxyAddrForHost(n,typeof e=="string"?parseInt(e,10):e)}catch(a){this.emit("error",a),this.emit("close");return}try{let a=(this.useSecureWebSocket?"wss:":"ws:")+"//"+o;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(a),s(this.ws);else try{this.ws=new WebSocket(a),s(this.ws)}catch{this.ws=new __unstable_WebSocket(a),s(this.ws)}}catch(a){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+o;fetch(c,{headers:{Upgrade:"websocket"}}).then(l=>{if(this.ws=l.webSocket,this.ws==null)throw a;this.ws.accept(),s(this.ws,!0)}).catch(l=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${l.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let n=this.subtls.TrustedCert.fromPEM(this.rootCerts),r=new this.subtls.WebSocketReadQueue(this.ws),i=r.read.bind(r),s=this.rawWrite.bind(this),[o,a]=await this.subtls.startTls(e,n,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=o,this.tlsWrite=a,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let n=Ue.from(e);this.emit("data",n)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let n=new Uint8Array(this.writeBuffer.length+e.length);n.set(this.writeBuffer),n.set(e,this.writeBuffer.length),this.writeBuffer=n}}write(e,n="utf8",r=i=>{}){return e.length===0?(r(),!0):(typeof e=="string"&&(e=Ue.from(e,n)),this.tlsState===0?(this.rawWrite(e),r()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,n,r)}):(this.tlsWrite(e),r()),!0)}end(e=Ue.alloc(0),n="utf8",r=()=>{}){return this.write(e,n,()=>{this.ws.close(),r()}),this}destroy(){return this.destroyed=!0,this.end()}},P(Wu,"Socket"),$e(Wu,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:P((t,e,n)=>{let r;return n?.jwtAuth?r=t.replace(w_,"apiauth."):r=t.replace(w_,"api."),"https://"+r+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:P(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),$e(Wu,"opts",{}),Ec=Wu}),i4=We(t=>{"use strict";Pe(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(Q,ce,fe){super(Q),this.length=ce,this.name=fe}};P(e,"DatabaseError");var n=e;t.DatabaseError=n;var r=class{constructor(Q,ce){this.length=Q,this.chunk=ce,this.name="copyData"}};P(r,"CopyDataMessage");var i=r;t.CopyDataMessage=i;var s=class{constructor(Q,ce,fe,me){this.length=Q,this.name=ce,this.binary=fe,this.columnTypes=new Array(me)}};P(s,"CopyResponse");var o=s;t.CopyResponse=o;var a=class{constructor(Q,ce,fe,me,Me,Re,it){this.name=Q,this.tableID=ce,this.columnID=fe,this.dataTypeID=me,this.dataTypeSize=Me,this.dataTypeModifier=Re,this.format=it}};P(a,"Field");var c=a;t.Field=c;var l=class{constructor(Q,ce){this.length=Q,this.fieldCount=ce,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};P(l,"RowDescriptionMessage");var u=l;t.RowDescriptionMessage=u;var p=class{constructor(Q,ce){this.length=Q,this.parameterCount=ce,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};P(p,"ParameterDescriptionMessage");var h=p;t.ParameterDescriptionMessage=h;var b=class{constructor(Q,ce,fe){this.length=Q,this.parameterName=ce,this.parameterValue=fe,this.name="parameterStatus"}};P(b,"ParameterStatusMessage");var y=b;t.ParameterStatusMessage=y;var g=class{constructor(Q,ce){this.length=Q,this.salt=ce,this.name="authenticationMD5Password"}};P(g,"AuthenticationMD5Password");var _=g;t.AuthenticationMD5Password=_;var x=class{constructor(Q,ce,fe){this.length=Q,this.processID=ce,this.secretKey=fe,this.name="backendKeyData"}};P(x,"BackendKeyDataMessage");var C=x;t.BackendKeyDataMessage=C;var T=class{constructor(Q,ce,fe,me){this.length=Q,this.processId=ce,this.channel=fe,this.payload=me,this.name="notification"}};P(T,"NotificationResponseMessage");var N=T;t.NotificationResponseMessage=N;var D=class{constructor(Q,ce){this.length=Q,this.status=ce,this.name="readyForQuery"}};P(D,"ReadyForQueryMessage");var A=D;t.ReadyForQueryMessage=A;var R=class{constructor(Q,ce){this.length=Q,this.text=ce,this.name="commandComplete"}};P(R,"CommandCompleteMessage");var q=R;t.CommandCompleteMessage=q;var k=class{constructor(Q,ce){this.length=Q,this.fields=ce,this.name="dataRow",this.fieldCount=ce.length}};P(k,"DataRowMessage");var z=k;t.DataRowMessage=z;var V=class{constructor(Q,ce){this.length=Q,this.message=ce,this.name="notice"}};P(V,"NoticeMessage");var re=V;t.NoticeMessage=re}),Hne=We(t=>{"use strict";Pe(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=Ue.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var o=this.buffer,a=o.length+(o.length>>1)+i;this.buffer=Ue.allocUnsafe(a),o.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=Ue.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=Ue.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=Ue.allocUnsafe(this.size),s}};P(e,"Writer");var n=e;t.Writer=n}),zne=We(t=>{"use strict";Pe(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=Hne(),n=new e.Writer,r=P(Q=>{n.addInt16(3).addInt16(0);for(let me of Object.keys(Q))n.addCString(me).addCString(Q[me]);n.addCString("client_encoding").addCString("UTF8");var ce=n.addCString("").flush(),fe=ce.length+4;return new e.Writer().addInt32(fe).add(ce).flush()},"startup"),i=P(()=>{let Q=Ue.allocUnsafe(8);return Q.writeInt32BE(8,0),Q.writeInt32BE(80877103,4),Q},"requestSsl"),s=P(Q=>n.addCString(Q).flush(112),"password"),o=P(function(Q,ce){return n.addCString(Q).addInt32(Ue.byteLength(ce)).addString(ce),n.flush(112)},"sendSASLInitialResponseMessage"),a=P(function(Q){return n.addString(Q).flush(112)},"sendSCRAMClientFinalMessage"),c=P(Q=>n.addCString(Q).flush(81),"query"),l=[],u=P(Q=>{let ce=Q.name||"";ce.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",ce,ce.length),console.error("This can cause conflicts and silent errors executing queries"));let fe=Q.types||l;for(var me=fe.length,Me=n.addCString(ce).addCString(Q.text).addInt16(me),Re=0;Re<me;Re++)Me.addInt32(fe[Re]);return n.flush(80)},"parse"),p=new e.Writer,h=P(function(Q,ce){for(let fe=0;fe<Q.length;fe++){let me=ce?ce(Q[fe],fe):Q[fe];me==null?(n.addInt16(0),p.addInt32(-1)):me instanceof Ue?(n.addInt16(1),p.addInt32(me.length),p.add(me)):(n.addInt16(0),p.addInt32(Ue.byteLength(me)),p.addString(me))}},"writeValues"),b=P((Q={})=>{let ce=Q.portal||"",fe=Q.statement||"",me=Q.binary||!1,Me=Q.values||l,Re=Me.length;return n.addCString(ce).addCString(fe),n.addInt16(Re),h(Me,Q.valueMapper),n.addInt16(Re),n.add(p.flush()),n.addInt16(me?1:0),n.flush(66)},"bind"),y=Ue.from([69,0,0,0,9,0,0,0,0,0]),g=P(Q=>{if(!Q||!Q.portal&&!Q.rows)return y;let ce=Q.portal||"",fe=Q.rows||0,me=Ue.byteLength(ce),Me=4+me+1+4,Re=Ue.allocUnsafe(1+Me);return Re[0]=69,Re.writeInt32BE(Me,1),Re.write(ce,5,"utf-8"),Re[me+5]=0,Re.writeUInt32BE(fe,Re.length-4),Re},"execute"),_=P((Q,ce)=>{let fe=Ue.allocUnsafe(16);return fe.writeInt32BE(16,0),fe.writeInt16BE(1234,4),fe.writeInt16BE(5678,6),fe.writeInt32BE(Q,8),fe.writeInt32BE(ce,12),fe},"cancel"),x=P((Q,ce)=>{let fe=4+Ue.byteLength(ce)+1,me=Ue.allocUnsafe(1+fe);return me[0]=Q,me.writeInt32BE(fe,1),me.write(ce,5,"utf-8"),me[fe]=0,me},"cstringMessage"),C=n.addCString("P").flush(68),T=n.addCString("S").flush(68),N=P(Q=>Q.name?x(68,`${Q.type}${Q.name||""}`):Q.type==="P"?C:T,"describe"),D=P(Q=>{let ce=`${Q.type}${Q.name||""}`;return x(67,ce)},"close"),A=P(Q=>n.add(Q).flush(100),"copyData"),R=P(Q=>x(102,Q),"copyFail"),q=P(Q=>Ue.from([Q,0,0,0,4]),"codeOnlyBuffer"),k=q(72),z=q(83),V=q(88),re=q(99),ae={startup:r,password:s,requestSsl:i,sendSASLInitialResponseMessage:o,sendSCRAMClientFinalMessage:a,query:c,parse:u,bind:b,execute:g,describe:N,close:D,flush:P(()=>k,"flush"),sync:P(()=>z,"sync"),end:P(()=>V,"end"),copyData:A,copyDone:P(()=>re,"copyDone"),copyFail:R,cancel:_};t.serialize=ae}),Vne=We(t=>{"use strict";Pe(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=Ue.allocUnsafe(0),n=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,o){this.offset=s,this.buffer=o}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let o=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,o}cstring(){let s=this.offset,o=s;for(;this.buffer[o++]!==0;);return this.offset=o,this.buffer.toString(this.encoding,s,o-1)}bytes(s){let o=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,o}};P(n,"BufferReader");var r=n;t.BufferReader=r}),jne=We(t=>{"use strict";Pe(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=i4(),n=Vne(),r=1,i=4,s=r+i,o=Ue.allocUnsafe(0),a=class{constructor(u){if(this.buffer=o,this.bufferLength=0,this.bufferOffset=0,this.reader=new n.BufferReader,u?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=u?.mode||"text"}parse(u,p){this.mergeBuffer(u);let h=this.bufferOffset+this.bufferLength,b=this.bufferOffset;for(;b+s<=h;){let y=this.buffer[b],g=this.buffer.readUInt32BE(b+r),_=r+g;if(_+b<=h){let x=this.handlePacket(b+s,y,g,this.buffer);p(x),b+=_}else break}b===h?(this.buffer=o,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=h-b,this.bufferOffset=b)}mergeBuffer(u){if(this.bufferLength>0){let p=this.bufferLength+u.byteLength;if(p+this.bufferOffset>this.buffer.byteLength){let h;if(p<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)h=this.buffer;else{let b=this.buffer.byteLength*2;for(;p>=b;)b*=2;h=Ue.allocUnsafe(b)}this.buffer.copy(h,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=h,this.bufferOffset=0}u.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=p}else this.buffer=u,this.bufferOffset=0,this.bufferLength=u.byteLength}handlePacket(u,p,h,b){switch(p){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(u,h,b);case 67:return this.parseCommandCompleteMessage(u,h,b);case 90:return this.parseReadyForQueryMessage(u,h,b);case 65:return this.parseNotificationMessage(u,h,b);case 82:return this.parseAuthenticationResponse(u,h,b);case 83:return this.parseParameterStatusMessage(u,h,b);case 75:return this.parseBackendKeyData(u,h,b);case 69:return this.parseErrorMessage(u,h,b,"error");case 78:return this.parseErrorMessage(u,h,b,"notice");case 84:return this.parseRowDescriptionMessage(u,h,b);case 116:return this.parseParameterDescriptionMessage(u,h,b);case 71:return this.parseCopyInMessage(u,h,b);case 72:return this.parseCopyOutMessage(u,h,b);case 100:return this.parseCopyData(u,h,b);default:return new e.DatabaseError("received invalid response: "+p.toString(16),h,"error")}}parseReadyForQueryMessage(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.string(1);return new e.ReadyForQueryMessage(p,b)}parseCommandCompleteMessage(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.cstring();return new e.CommandCompleteMessage(p,b)}parseCopyData(u,p,h){let b=h.slice(u,u+(p-4));return new e.CopyDataMessage(p,b)}parseCopyInMessage(u,p,h){return this.parseCopyMessage(u,p,h,"copyInResponse")}parseCopyOutMessage(u,p,h){return this.parseCopyMessage(u,p,h,"copyOutResponse")}parseCopyMessage(u,p,h,b){this.reader.setBuffer(u,h);let y=this.reader.byte()!==0,g=this.reader.int16(),_=new e.CopyResponse(p,b,y,g);for(let x=0;x<g;x++)_.columnTypes[x]=this.reader.int16();return _}parseNotificationMessage(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.int32(),y=this.reader.cstring(),g=this.reader.cstring();return new e.NotificationResponseMessage(p,b,y,g)}parseRowDescriptionMessage(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.int16(),y=new e.RowDescriptionMessage(p,b);for(let g=0;g<b;g++)y.fields[g]=this.parseField();return y}parseField(){let u=this.reader.cstring(),p=this.reader.int32(),h=this.reader.int16(),b=this.reader.int32(),y=this.reader.int16(),g=this.reader.int32(),_=this.reader.int16()===0?"text":"binary";return new e.Field(u,p,h,b,y,g,_)}parseParameterDescriptionMessage(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.int16(),y=new e.ParameterDescriptionMessage(p,b);for(let g=0;g<b;g++)y.dataTypeIDs[g]=this.reader.int32();return y}parseDataRowMessage(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.int16(),y=new Array(b);for(let g=0;g<b;g++){let _=this.reader.int32();y[g]=_===-1?null:this.reader.string(_)}return new e.DataRowMessage(p,y)}parseParameterStatusMessage(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.cstring(),y=this.reader.cstring();return new e.ParameterStatusMessage(p,b,y)}parseBackendKeyData(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.int32(),y=this.reader.int32();return new e.BackendKeyDataMessage(p,b,y)}parseAuthenticationResponse(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.int32(),y={name:"authenticationOk",length:p};switch(b){case 0:break;case 3:y.length===8&&(y.name="authenticationCleartextPassword");break;case 5:if(y.length===12){y.name="authenticationMD5Password";let _=this.reader.bytes(4);return new e.AuthenticationMD5Password(p,_)}break;case 10:y.name="authenticationSASL",y.mechanisms=[];let g;do g=this.reader.cstring(),g&&y.mechanisms.push(g);while(g);break;case 11:y.name="authenticationSASLContinue",y.data=this.reader.string(p-8);break;case 12:y.name="authenticationSASLFinal",y.data=this.reader.string(p-8);break;default:throw new Error("Unknown authenticationOk message type "+b)}return y}parseErrorMessage(u,p,h,b){this.reader.setBuffer(u,h);let y={},g=this.reader.string(1);for(;g!=="\0";)y[g]=this.reader.cstring(),g=this.reader.string(1);let _=y.M,x=b==="notice"?new e.NoticeMessage(p,_):new e.DatabaseError(_,p,b);return x.severity=y.S,x.code=y.C,x.detail=y.D,x.hint=y.H,x.position=y.P,x.internalPosition=y.p,x.internalQuery=y.q,x.where=y.W,x.schema=y.s,x.table=y.t,x.column=y.c,x.dataType=y.d,x.constraint=y.n,x.file=y.F,x.line=y.L,x.routine=y.R,x}};P(a,"Parser");var c=a;t.Parser=c}),s4=We(t=>{"use strict";Pe(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=i4();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:P(function(){return e.DatabaseError},"get")});var n=zne();Object.defineProperty(t,"serialize",{enumerable:!0,get:P(function(){return n.serialize},"get")});var r=jne();function i(s,o){let a=new r.Parser;return s.on("data",c=>a.parse(c,o)),new Promise(c=>s.on("end",()=>c()))}P(i,"parse"),t.parse=i}),o4={};Gr(o4,{connect:()=>a4});function a4({socket:t,servername:e}){return t.startTls(e),t}var Wne=zn(()=>{"use strict";Pe(),P(a4,"connect")}),c4=We((t,e)=>{"use strict";Pe();var n=(R_(),sn(n4)),r=Do().EventEmitter,{parse:i,serialize:s}=s4(),o=s.flush(),a=s.sync(),c=s.end(),l=class extends r{constructor(h){super(),h=h||{},this.stream=h.stream||new n.Socket,this._keepAlive=h.keepAlive,this._keepAliveInitialDelayMillis=h.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=h.ssl||!1,this._ending=!1,this._emitMessage=!1;var b=this;this.on("newListener",function(y){y==="message"&&(b._emitMessage=!0)})}connect(h,b){var y=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(h,b),this.stream.once("connect",function(){y._keepAlive&&y.stream.setKeepAlive(!0,y._keepAliveInitialDelayMillis),y.emit("connect")});let g=P(function(_){y._ending&&(_.code==="ECONNRESET"||_.code==="EPIPE")||y.emit("error",_)},"reportStreamError");if(this.stream.on("error",g),this.stream.on("close",function(){y.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(_){var x=_.toString("utf8");switch(x){case"S":break;case"N":return y.stream.end(),y.emit("error",new Error("The server does not support SSL connections"));default:return y.stream.end(),y.emit("error",new Error("There was an error establishing an SSL connection"))}var C=(Wne(),sn(o4));let T={socket:y.stream};y.ssl!==!0&&(Object.assign(T,y.ssl),"key"in y.ssl&&(T.key=y.ssl.key)),n.isIP(b)===0&&(T.servername=b);try{y.stream=C.connect(T)}catch(N){return y.emit("error",N)}y.attachListeners(y.stream),y.stream.on("error",g),y.emit("sslconnect")})}attachListeners(h){h.on("end",()=>{this.emit("end")}),i(h,b=>{var y=b.name==="error"?"errorMessage":b.name;this._emitMessage&&this.emit("message",b),this.emit(y,b)})}requestSsl(){this.stream.write(s.requestSsl())}startup(h){this.stream.write(s.startup(h))}cancel(h,b){this._send(s.cancel(h,b))}password(h){this._send(s.password(h))}sendSASLInitialResponseMessage(h,b){this._send(s.sendSASLInitialResponseMessage(h,b))}sendSCRAMClientFinalMessage(h){this._send(s.sendSCRAMClientFinalMessage(h))}_send(h){return this.stream.writable?this.stream.write(h):!1}query(h){this._send(s.query(h))}parse(h){this._send(s.parse(h))}bind(h){this._send(s.bind(h))}execute(h){this._send(s.execute(h))}flush(){this.stream.writable&&this.stream.write(o)}sync(){this._ending=!0,this._send(o),this._send(a)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(h){this._send(s.close(h))}describe(h){this._send(s.describe(h))}sendCopyFromChunk(h){this._send(s.copyData(h))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(h){this._send(s.copyFail(h))}};P(l,"Connection");var u=l;e.exports=u}),Qne=We((t,e)=>{"use strict";Pe();var n=Do().EventEmitter,r=(wh(),sn(Ju)),i=Sh(),s=One(),o=Fne(),a=I_(),c=k_(),l=Gne(),u=xh(),p=c4(),h=class extends n{constructor(g){super(),this.connectionParameters=new c(g),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var _=g||{};this._Promise=_.Promise||bh.Promise,this._types=new a(_.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=_.connection||new p({stream:_.stream,ssl:this.connectionParameters.ssl,keepAlive:_.keepAlive||!1,keepAliveInitialDelayMillis:_.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=_.binary||u.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=_.connectionTimeoutMillis||0}_errorAllQueries(g){let _=P(x=>{je.nextTick(()=>{x.handleError(g,this.connection)})},"enqueueError");this.activeQuery&&(_(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(_),this.queryQueue.length=0}_connect(g){var _=this,x=this.connection;if(this._connectionCallback=g,this._connecting||this._connected){let C=new Error("Client has already been connected. You cannot reuse a client.");je.nextTick(()=>{g(C)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{x._ending=!0,x.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?x.connect(this.host+"/.s.PGSQL."+this.port):x.connect(this.port,this.host),x.on("connect",function(){_.ssl?x.requestSsl():x.startup(_.getStartupConf())}),x.on("sslconnect",function(){x.startup(_.getStartupConf())}),this._attachListeners(x),x.once("end",()=>{let C=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(C),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(C):this._handleErrorEvent(C):this._connectionError||this._handleErrorEvent(C)),je.nextTick(()=>{this.emit("end")})})}connect(g){if(g){this._connect(g);return}return new this._Promise((_,x)=>{this._connect(C=>{C?x(C):_()})})}_attachListeners(g){g.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),g.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),g.on("authenticationSASL",this._handleAuthSASL.bind(this)),g.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),g.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),g.on("backendKeyData",this._handleBackendKeyData.bind(this)),g.on("error",this._handleErrorEvent.bind(this)),g.on("errorMessage",this._handleErrorMessage.bind(this)),g.on("readyForQuery",this._handleReadyForQuery.bind(this)),g.on("notice",this._handleNotice.bind(this)),g.on("rowDescription",this._handleRowDescription.bind(this)),g.on("dataRow",this._handleDataRow.bind(this)),g.on("portalSuspended",this._handlePortalSuspended.bind(this)),g.on("emptyQuery",this._handleEmptyQuery.bind(this)),g.on("commandComplete",this._handleCommandComplete.bind(this)),g.on("parseComplete",this._handleParseComplete.bind(this)),g.on("copyInResponse",this._handleCopyInResponse.bind(this)),g.on("copyData",this._handleCopyData.bind(this)),g.on("notification",this._handleNotification.bind(this))}_checkPgPass(g){let _=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(x=>{if(x!==void 0){if(typeof x!="string"){_.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=x}else this.connectionParameters.password=this.password=null;g()}).catch(x=>{_.emit("error",x)}):this.password!==null?g():o(this.connectionParameters,x=>{x!==void 0&&(this.connectionParameters.password=this.password=x),g()})}_handleAuthCleartextPassword(g){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(g){this._checkPgPass(()=>{let _=i.postgresMd5PasswordHash(this.user,this.password,g.salt);this.connection.password(_)})}_handleAuthSASL(g){this._checkPgPass(()=>{this.saslSession=s.startSession(g.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(g){s.continueSession(this.saslSession,this.password,g.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(g){s.finalizeSession(this.saslSession,g.data),this.saslSession=null}_handleBackendKeyData(g){this.processID=g.processID,this.secretKey=g.secretKey}_handleReadyForQuery(g){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:_}=this;this.activeQuery=null,this.readyForQuery=!0,_&&_.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(g){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(g);this.emit("error",g)}}_handleErrorEvent(g){if(this._connecting)return this._handleErrorWhileConnecting(g);this._queryable=!1,this._errorAllQueries(g),this.emit("error",g)}_handleErrorMessage(g){if(this._connecting)return this._handleErrorWhileConnecting(g);let _=this.activeQuery;if(!_){this._handleErrorEvent(g);return}this.activeQuery=null,_.handleError(g,this.connection)}_handleRowDescription(g){this.activeQuery.handleRowDescription(g)}_handleDataRow(g){this.activeQuery.handleDataRow(g)}_handlePortalSuspended(g){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(g){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(g){this.activeQuery.handleCommandComplete(g,this.connection)}_handleParseComplete(g){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(g){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(g){this.activeQuery.handleCopyData(g,this.connection)}_handleNotification(g){this.emit("notification",g)}_handleNotice(g){this.emit("notice",g)}getStartupConf(){var g=this.connectionParameters,_={user:g.user,database:g.database},x=g.application_name||g.fallback_application_name;return x&&(_.application_name=x),g.replication&&(_.replication=""+g.replication),g.statement_timeout&&(_.statement_timeout=String(parseInt(g.statement_timeout,10))),g.lock_timeout&&(_.lock_timeout=String(parseInt(g.lock_timeout,10))),g.idle_in_transaction_session_timeout&&(_.idle_in_transaction_session_timeout=String(parseInt(g.idle_in_transaction_session_timeout,10))),g.options&&(_.options=g.options),_}cancel(g,_){if(g.activeQuery===_){var x=this.connection;this.host&&this.host.indexOf("/")===0?x.connect(this.host+"/.s.PGSQL."+this.port):x.connect(this.port,this.host),x.on("connect",function(){x.cancel(g.processID,g.secretKey)})}else g.queryQueue.indexOf(_)!==-1&&g.queryQueue.splice(g.queryQueue.indexOf(_),1)}setTypeParser(g,_,x){return this._types.setTypeParser(g,_,x)}getTypeParser(g,_){return this._types.getTypeParser(g,_)}escapeIdentifier(g){return'"'+g.replace(/"/g,'""')+'"'}escapeLiteral(g){for(var _=!1,x="'",C=0;C<g.length;C++){var T=g[C];T==="'"?x+=T+T:T==="\\"?(x+=T+T,_=!0):x+=T}return x+="'",_===!0&&(x=" E"+x),x}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let g=this.activeQuery.submit(this.connection);g&&je.nextTick(()=>{this.activeQuery.handleError(g,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(g,_,x){var C,T,N,D,A;if(g==null)throw new TypeError("Client was passed a null or undefined query");return typeof g.submit=="function"?(N=g.query_timeout||this.connectionParameters.query_timeout,T=C=g,typeof _=="function"&&(C.callback=C.callback||_)):(N=this.connectionParameters.query_timeout,C=new l(g,_,x),C.callback||(T=new this._Promise((R,q)=>{C.callback=(k,z)=>k?q(k):R(z)}))),N&&(A=C.callback,D=setTimeout(()=>{var R=new Error("Query read timeout");je.nextTick(()=>{C.handleError(R,this.connection)}),A(R),C.callback=()=>{};var q=this.queryQueue.indexOf(C);q>-1&&this.queryQueue.splice(q,1),this._pulseQueryQueue()},N),C.callback=(R,q)=>{clearTimeout(D),A(R,q)}),this.binary&&!C.binary&&(C.binary=!0),C._result&&!C._result._types&&(C._result._types=this._types),this._queryable?this._ending?(je.nextTick(()=>{C.handleError(new Error("Client was closed and is not queryable"),this.connection)}),T):(this.queryQueue.push(C),this._pulseQueryQueue(),T):(je.nextTick(()=>{C.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),T)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(g){if(this._ending=!0,!this.connection._connecting)if(g)g();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),g)this.connection.once("end",g);else return new this._Promise(_=>{this.connection.once("end",_)})}};P(h,"Client");var b=h;b.Query=l,e.exports=b}),Jne=We((t,e)=>{"use strict";Pe();var n=Do().EventEmitter,r=P(function(){},"NOOP"),i=P((y,g)=>{let _=y.findIndex(g);return _===-1?void 0:y.splice(_,1)[0]},"removeWhere"),s=class{constructor(g,_,x){this.client=g,this.idleListener=_,this.timeoutId=x}};P(s,"IdleItem");var o=s,a=class{constructor(g){this.callback=g}};P(a,"PendingItem");var c=a;function l(){throw new Error("Release called on client which has already been released to the pool.")}P(l,"throwOnDoubleRelease");function u(y,g){if(g)return{callback:g,result:void 0};let _,x,C=P(function(N,D){N?_(N):x(D)},"cb"),T=new y(function(N,D){x=N,_=D}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:C,result:T}}P(u,"promisify");function p(y,g){return P(function _(x){x.client=g,g.removeListener("error",_),g.on("error",()=>{y.log("additional client error after disconnection due to error",x)}),y._remove(g),y.emit("error",x,g)},"idleListener")}P(p,"makeIdleListener");var h=class extends n{constructor(g,_){super(),this.options=Object.assign({},g),g!=null&&"password"in g&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:g.password}),g!=null&&g.ssl&&g.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||_||N_().Client,this.Promise=this.options.Promise||bh.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(_=>{this._remove(_.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let g=this._pendingQueue.shift();if(this._idle.length){let _=this._idle.pop();clearTimeout(_.timeoutId);let x=_.client;x.ref&&x.ref();let C=_.idleListener;return this._acquireClient(x,g,C,!1)}if(!this._isFull())return this.newClient(g);throw new Error("unexpected condition")}_remove(g){let _=i(this._idle,x=>x.client===g);_!==void 0&&clearTimeout(_.timeoutId),this._clients=this._clients.filter(x=>x!==g),g.end(),this.emit("remove",g)}connect(g){if(this.ending){let C=new Error("Cannot use a pool after calling end on the pool");return g?g(C):this.Promise.reject(C)}let _=u(this.Promise,g),x=_.result;if(this._isFull()||this._idle.length){if(this._idle.length&&je.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(_.callback)),x;let C=P((D,A,R)=>{clearTimeout(N),_.callback(D,A,R)},"queueCallback"),T=new c(C),N=setTimeout(()=>{i(this._pendingQueue,D=>D.callback===C),T.timedOut=!0,_.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(T),x}return this.newClient(new c(_.callback)),x}newClient(g){let _=new this.Client(this.options);this._clients.push(_);let x=p(this,_);this.log("checking client timeout");let C,T=!1;this.options.connectionTimeoutMillis&&(C=setTimeout(()=>{this.log("ending client due to timeout"),T=!0,_.connection?_.connection.stream.destroy():_.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),_.connect(N=>{if(C&&clearTimeout(C),_.on("error",x),N)this.log("client failed to connect",N),this._clients=this._clients.filter(D=>D!==_),T&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),g.timedOut||g.callback(N,void 0,r);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let D=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(_),this._idle.findIndex(A=>A.client===_)!==-1&&this._acquireClient(_,new c((A,R,q)=>q()),x,!1)},this.options.maxLifetimeSeconds*1e3);D.unref(),_.once("end",()=>clearTimeout(D))}return this._acquireClient(_,g,x,!0)}})}_acquireClient(g,_,x,C){C&&this.emit("connect",g),this.emit("acquire",g),g.release=this._releaseOnce(g,x),g.removeListener("error",x),_.timedOut?C&&this.options.verify?this.options.verify(g,g.release):g.release():C&&this.options.verify?this.options.verify(g,T=>{if(T)return g.release(T),_.callback(T,void 0,r);_.callback(void 0,g,g.release)}):_.callback(void 0,g,g.release)}_releaseOnce(g,_){let x=!1;return C=>{x&&l(),x=!0,this._release(g,_,C)}}_release(g,_,x){if(g.on("error",_),g._poolUseCount=(g._poolUseCount||0)+1,this.emit("release",x,g),x||this.ending||!g._queryable||g._ending||g._poolUseCount>=this.options.maxUses){g._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(g),this._pulseQueue();return}if(this._expired.has(g)){this.log("remove expired client"),this._expired.delete(g),this._remove(g),this._pulseQueue();return}let C;this.options.idleTimeoutMillis&&(C=setTimeout(()=>{this.log("remove idle client"),this._remove(g)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&C.unref()),this.options.allowExitOnIdle&&g.unref(),this._idle.push(new o(g,_,C)),this._pulseQueue()}query(g,_,x){if(typeof g=="function"){let T=u(this.Promise,g);return S_(function(){return T.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),T.result}typeof _=="function"&&(x=_,_=void 0);let C=u(this.Promise,x);return x=C.callback,this.connect((T,N)=>{if(T)return x(T);let D=!1,A=P(R=>{D||(D=!0,N.release(R),x(R))},"onError");N.once("error",A),this.log("dispatching query");try{N.query(g,_,(R,q)=>{if(this.log("query dispatched"),N.removeListener("error",A),!D)return D=!0,N.release(R),R?x(R):x(void 0,q)})}catch(R){return N.release(R),x(R)}}),C.result}end(g){if(this.log("ending"),this.ending){let x=new Error("Called end on pool more than once");return g?g(x):this.Promise.reject(x)}this.ending=!0;let _=u(this.Promise,g);return this._endCallback=_.callback,this._pulseQueue(),_.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((g,_)=>g+(this._expired.has(_)?1:0),0)}get totalCount(){return this._clients.length}};P(h,"Pool");var b=h;e.exports=b}),l4={};Gr(l4,{default:()=>u4});var u4,Kne=zn(()=>{"use strict";Pe(),u4={}}),Yne=We((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),Xne=We((t,e)=>{"use strict";Pe();var n=Do().EventEmitter,r=(wh(),sn(Ju)),i=Sh(),s=e.exports=function(a,c,l){n.call(this),a=i.normalizeQueryConfig(a,c,l),this.text=a.text,this.values=a.values,this.name=a.name,this.callback=a.callback,this.state="new",this._arrayMode=a.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(u){u==="row"&&(this._emitRowEvents=!0)}.bind(this))};r.inherits(s,n);var o={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(a){var c=this.native.pq.resultErrorFields();if(c)for(var l in c){var u=o[l]||l;a[u]=c[l]}this.callback?this.callback(a):this.emit("error",a),this.state="error"},s.prototype.then=function(a,c){return this._getPromise().then(a,c)},s.prototype.catch=function(a){return this._getPromise().catch(a)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(a,c){this._once("end",a),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(a){this.state="running";var c=this;this.native=a.native,a.native.arrayMode=this._arrayMode;var l=P(function(h,b,y){if(a.native.arrayMode=!1,S_(function(){c.emit("_done")}),h)return c.handleError(h);c._emitRowEvents&&(y.length>1?b.forEach((g,_)=>{g.forEach(x=>{c.emit("row",x,y[_])})}):b.forEach(function(g){c.emit("row",g,y)})),c.state="end",c.emit("end",y),c.callback&&c.callback(null,y)},"after");if(je.domain&&(l=je.domain.bind(l)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var u=(this.values||[]).map(i.prepareValue);if(a.namedQueries[this.name]){if(this.text&&a.namedQueries[this.name]!==this.text){let h=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return l(h)}return a.native.execute(this.name,u,l)}return a.native.prepare(this.name,this.text,u.length,function(h){return h?l(h):(a.namedQueries[c.name]=c.text,c.native.execute(c.name,u,l))})}else if(this.values){if(!Array.isArray(this.values)){let h=new Error("Query values must be an array");return l(h)}var p=this.values.map(i.prepareValue);a.native.query(this.text,p,l)}else a.native.query(this.text,l)}}),Zne=We((t,e)=>{"use strict";Pe();var n=(Kne(),sn(l4)),r=I_(),i=Yne(),s=Do().EventEmitter,o=(wh(),sn(Ju)),a=k_(),c=Xne(),l=e.exports=function(u){s.call(this),u=u||{},this._Promise=u.Promise||bh.Promise,this._types=new r(u.types),this.native=new n({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var p=this.connectionParameters=new a(u);this.user=p.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),this.database=p.database,this.host=p.host,this.port=p.port,this.namedQueries={}};l.Query=c,o.inherits(l,s),l.prototype._errorAllQueries=function(u){let p=P(h=>{je.nextTick(()=>{h.native=this.native,h.handleError(u)})},"enqueueError");this._hasActiveQuery()&&(p(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(p),this._queryQueue.length=0},l.prototype._connect=function(u){var p=this;if(this._connecting){je.nextTick(()=>u(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(h,b){if(h)return u(h);p.native.connect(b,function(y){if(y)return p.native.end(),u(y);p._connected=!0,p.native.on("error",function(g){p._queryable=!1,p._errorAllQueries(g),p.emit("error",g)}),p.native.on("notification",function(g){p.emit("notification",{channel:g.relname,payload:g.extra})}),p.emit("connect"),p._pulseQueryQueue(!0),u()})})},l.prototype.connect=function(u){if(u){this._connect(u);return}return new this._Promise((p,h)=>{this._connect(b=>{b?h(b):p()})})},l.prototype.query=function(u,p,h){var b,y,g,_,x;if(u==null)throw new TypeError("Client was passed a null or undefined query");if(typeof u.submit=="function")g=u.query_timeout||this.connectionParameters.query_timeout,y=b=u,typeof p=="function"&&(u.callback=p);else if(g=this.connectionParameters.query_timeout,b=new c(u,p,h),!b.callback){let C,T;y=new this._Promise((N,D)=>{C=N,T=D}),b.callback=(N,D)=>N?T(N):C(D)}return g&&(x=b.callback,_=setTimeout(()=>{var C=new Error("Query read timeout");je.nextTick(()=>{b.handleError(C,this.connection)}),x(C),b.callback=()=>{};var T=this._queryQueue.indexOf(b);T>-1&&this._queryQueue.splice(T,1),this._pulseQueryQueue()},g),b.callback=(C,T)=>{clearTimeout(_),x(C,T)}),this._queryable?this._ending?(b.native=this.native,je.nextTick(()=>{b.handleError(new Error("Client was closed and is not queryable"))}),y):(this._queryQueue.push(b),this._pulseQueryQueue(),y):(b.native=this.native,je.nextTick(()=>{b.handleError(new Error("Client has encountered a connection error and is not queryable"))}),y)},l.prototype.end=function(u){var p=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,u));var h;return u||(h=new this._Promise(function(b,y){u=P(g=>g?y(g):b(),"cb")})),this.native.end(function(){p._errorAllQueries(new Error("Connection terminated")),je.nextTick(()=>{p.emit("end"),u&&u()})}),h},l.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},l.prototype._pulseQueryQueue=function(u){if(this._connected&&!this._hasActiveQuery()){var p=this._queryQueue.shift();if(!p){u||this.emit("drain");return}this._activeQuery=p,p.submit(this);var h=this;p.once("_done",function(){h._pulseQueryQueue()})}},l.prototype.cancel=function(u){this._activeQuery===u?this.native.cancel(function(){}):this._queryQueue.indexOf(u)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(u),1)},l.prototype.ref=function(){},l.prototype.unref=function(){},l.prototype.setTypeParser=function(u,p,h){return this._types.setTypeParser(u,p,h)},l.prototype.getTypeParser=function(u,p){return this._types.getTypeParser(u,p)}}),M8=We((t,e)=>{"use strict";Pe(),e.exports=Zne()}),N_=We((t,e)=>{"use strict";Pe();var n=Qne(),r=xh(),i=c4(),s=Jne(),{DatabaseError:o}=s4(),a=P(l=>{var u;return u=class extends s{constructor(p){super(p,l)}},P(u,"BoundPool"),u},"poolFactory"),c=P(function(l){this.defaults=r,this.Client=l,this.Query=this.Client.Query,this.Pool=a(this.Client),this._pools=[],this.Connection=i,this.types=_h(),this.DatabaseError=o},"PG");typeof je.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(M8()):(e.exports=new c(n),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var l=null;try{l=new c(M8())}catch(u){if(u.code!=="MODULE_NOT_FOUND")throw u}return Object.defineProperty(e.exports,"native",{value:l}),l}}))});Pe();var f4=Sc(N_());R_();Pe();R_();t4();var ere=Sc(Sh()),tre=Sc(I_());function p4(t){return t instanceof Ue?"\\x"+t.toString("hex"):t}P(p4,"encodeBuffersAsBytea");var d4=class h4 extends Error{constructor(e){super(e),$e(this,"name","NeonDbError"),$e(this,"severity"),$e(this,"code"),$e(this,"detail"),$e(this,"hint"),$e(this,"position"),$e(this,"internalPosition"),$e(this,"internalQuery"),$e(this,"where"),$e(this,"schema"),$e(this,"table"),$e(this,"column"),$e(this,"dataType"),$e(this,"constraint"),$e(this,"file"),$e(this,"line"),$e(this,"routine"),$e(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,h4)}};P(d4,"NeonDbError");var _c=d4,O8="transaction() expects an array of queries, or a function returning an array of queries",nre=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function m4(t,{arrayMode:e,fullResults:n,fetchOptions:r,isolationLevel:i,readOnly:s,deferrable:o,queryCallback:a,resultCallback:c,authToken:l}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let u;try{u=P_(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:p,username:h,hostname:b,port:y,pathname:g}=u;if(p!=="postgres:"&&p!=="postgresql:"||!h||!b||!g)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function _(C,...T){let N,D;if(typeof C=="string")N=C,D=T[1],T=T[0]??[];else{N="";for(let R=0;R<C.length;R++)N+=C[R],R<T.length&&(N+="$"+(R+1))}T=T.map(R=>p4((0,ere.prepareValue)(R)));let A={query:N,params:T};return a&&a(A),g4(x,A,D)}P(_,"resolve"),_.transaction=async(C,T)=>{if(typeof C=="function"&&(C=C(_)),!Array.isArray(C))throw new Error(O8);C.forEach(A=>{if(A[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(O8)});let N=C.map(A=>A.parameterizedQuery),D=C.map(A=>A.opts??{});return x(N,D,T)};async function x(C,T,N){let{fetchEndpoint:D,fetchFunction:A}=Ec,R=Array.isArray(C)?{queries:C}:C,q=r??{},k=e??!1,z=n??!1,V=i,re=s,ae=o;N!==void 0&&(N.fetchOptions!==void 0&&(q={...q,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(z=N.fullResults),N.isolationLevel!==void 0&&(V=N.isolationLevel),N.readOnly!==void 0&&(re=N.readOnly),N.deferrable!==void 0&&(ae=N.deferrable)),T!==void 0&&!Array.isArray(T)&&T.fetchOptions!==void 0&&(q={...q,...T.fetchOptions});let Q=l;!Array.isArray(T)&&T?.authToken!==void 0&&(Q=T.authToken);let ce=typeof D=="function"?D(b,y,{jwtAuth:Q!==void 0}):D,fe={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},me=await y4(Q);me&&(fe.Authorization=`Bearer ${me}`),Array.isArray(C)&&(V!==void 0&&(fe["Neon-Batch-Isolation-Level"]=V),re!==void 0&&(fe["Neon-Batch-Read-Only"]=String(re)),ae!==void 0&&(fe["Neon-Batch-Deferrable"]=String(ae)));let Me;try{Me=await(A??fetch)(ce,{method:"POST",body:JSON.stringify(R),headers:fe,...q})}catch(Re){let it=new _c(`Error connecting to database: ${Re.message}`);throw it.sourceError=Re,it}if(Me.ok){let Re=await Me.json();if(Array.isArray(C)){let it=Re.results;if(!Array.isArray(it))throw new _c("Neon internal error: unexpected result format");return it.map((Qe,ye)=>{let le=T[ye]??{},at=le.arrayMode??k,st=le.fullResults??z;return x_(Qe,{arrayMode:at,fullResults:st,parameterizedQuery:C[ye],resultCallback:c,types:le.types})})}else{let it=T??{},Qe=it.arrayMode??k,ye=it.fullResults??z;return x_(Re,{arrayMode:Qe,fullResults:ye,parameterizedQuery:C,resultCallback:c,types:it.types})}}else{let{status:Re}=Me;if(Re===400){let it=await Me.json(),Qe=new _c(it.message);for(let ye of nre)Qe[ye]=it[ye]??void 0;throw Qe}else{let it=await Me.text();throw new _c(`Server error (HTTP status ${Re}): ${it}`)}}}return P(x,"execute"),_}P(m4,"neon");function g4(t,e,n){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:n,then:P((r,i)=>t(e,n).then(r,i),"then"),catch:P(r=>t(e,n).catch(r),"catch"),finally:P(r=>t(e,n).finally(r),"finally")}}P(g4,"createNeonQueryPromise");function x_(t,{arrayMode:e,fullResults:n,parameterizedQuery:r,resultCallback:i,types:s}){let o=new tre.default(s),a=t.fields.map(u=>u.name),c=t.fields.map(u=>o.getTypeParser(u.dataTypeID)),l=e===!0?t.rows.map(u=>u.map((p,h)=>p===null?null:c[h](p))):t.rows.map(u=>Object.fromEntries(u.map((p,h)=>[a[h],p===null?null:c[h](p)])));return i&&i(r,t,l,{arrayMode:e,fullResults:n}),n?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=l,t._parsers=c,t._types=o,t):l}P(x_,"processQueryResult");async function y4(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let n=new _c("Error getting auth token.");throw e instanceof Error&&(n=new _c(`Error getting auth token: ${e.message}`)),n}}P(y4,"getAuthToken");var rre=Sc(k_()),Tc=Sc(N_()
Node.js v20.19.6
==> Exited with status 1
==> Common ways to troubleshoot your deploy: https://render.com/docs/troubleshooting-deploys
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:138
`);c.write(s.format.apply(s,A))}}P(x,"warn"),Object.defineProperty(e.exports,"isWin",{get:P(function(){return a},"get"),set:P(function(D){a=D},"set")}),e.exports.warnTo=function(D){var A=c;return c=D,A},e.exports.getFileName=function(D){var A=D||je.env,R=A.PGPASSFILE||(a?n.join(A.APPDATA||"./","postgresql","pgpass.conf"):n.join(A.HOME||"./",".pgpass"));return R},e.exports.usePgPass=function(D,A){return Object.prototype.hasOwnProperty.call(je.env,"PGPASSWORD")?!1:a?!0:(A=A||"<unkn>",b(D.mode)?D.mode&(l|u)?(x('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',A),!1):!0:(x('WARNING: password file "%s" is not a plain file',A),!1))};var C=e.exports.match=function(D,A){return y.slice(0,-1).reduce(function(R,q,k){return k==1&&Number(D[q]||o)===Number(A[q])?R&&!0:R&&(A[q]==="*"||A[q]===D[q])},!0)};e.exports.getPassword=function(D,A,R){var q,k=A.pipe(i());function z(ae){var Q=T(ae);Q&&N(Q)&&C(D,Q)&&(q=Q[_],k.end())}P(z,"onLine");var V=P(function(){A.destroy(),R(q)},"onEnd"),re=P(function(ae){A.destroy(),x("WARNING: error on reading file: %s",ae),R(void 0)},"onErr");A.on("error",re),k.on("data",z).on("end",V).on("error",re)};var T=e.exports.parseLine=function(D){if(D.length<11||D.match(/^\s+#/))return null;for(var A="",R="",q=0,k=0,z=0,V={},re=!1,ae=P(function(ce,fe,me){var Me=D.substring(fe,me);Object.hasOwnProperty.call(je.env,"PGPASS_NO_DEESCAPE")||(Me=Me.replace(/\\([:\\])/g,"$1")),V[y[ce]]=Me},"addToObj"),Q=0;Q<D.length-1;Q+=1){if(A=D.charAt(Q+1),R=D.charAt(Q),re=q==g-1,re){ae(q,k);break}Q>=0&&A==":"&&R!=="\\"&&(ae(q,k,Q+1),k=Q+2,q+=1)}return V=Object.keys(V).length===g?V:null,V},N=e.exports.isValidEntry=function(D){for(var A={0:function(V){return V.length>0},1:function(V){return V==="*"?!0:(V=Number(V),isFinite(V)&&V>0&&V<9007199254740992&&Math.floor(V)===V)},2:function(V){return V.length>0},3:function(V){return V.length>0},4:function(V){return V.length>0}},R=0;R<y.length;R+=1){var q=A[R],k=D[y[R]]||"",z=q(k);if(!z)return!1}return!0}}),Fne=We((t,e)=>{"use strict";Pe();var n=(V8(),sn(T_)),r=(W8(),sn(C_)),i=Lne();e.exports=function(s,o){var a=i.getFileName();r.stat(a,function(c,l){if(c||!i.usePgPass(l,a))return o(void 0);var u=r.createReadStream(a);i.getPassword(s,u,o)})},e.exports.warnTo=i.warnTo}),I_=We((t,e)=>{"use strict";Pe();var n=_h();function r(i){this._types=i||n,this.text={},this.binary={}}P(r,"TypeOverrides"),r.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},r.prototype.setTypeParser=function(i,s,o){typeof s=="function"&&(o=s,s="text"),this.getOverrides(s)[i]=o},r.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=r}),X8={};Gr(X8,{default:()=>Z8});var Z8,Une=zn(()=>{"use strict";Pe(),Z8={}}),e4={};Gr(e4,{parse:()=>P_});function P_(t,e=!1){let{protocol:n}=new URL(t),r="http:"+t.substring(n.length),{username:i,password:s,host:o,hostname:a,port:c,pathname:l,search:u,searchParams:p,hash:h}=new URL(r);s=decodeURIComponent(s),i=decodeURIComponent(i),l=decodeURIComponent(l);let b=i+":"+s,y=e?Object.fromEntries(p.entries()):u;return{href:t,protocol:n,auth:b,username:i,password:s,host:o,hostname:a,port:c,pathname:l,search:u,query:y,hash:h}}var t4=zn(()=>{"use strict";Pe(),P(P_,"parse")}),Bne=We((t,e)=>{"use strict";Pe();var n=(t4(),sn(e4)),r=(W8(),sn(C_));function i(s){if(s.charAt(0)==="/"){var a=s.split(" ");return{host:a[0],database:a[1]}}var o=n.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),a=o.query;for(var c in a)Array.isArray(a[c])&&(a[c]=a[c][a[c].length-1]);var l=(o.auth||":").split(":");if(a.user=l[0],a.password=l.splice(1).join(":"),a.port=o.port,o.protocol=="socket:")return a.host=decodeURI(o.pathname),a.database=o.query.db,a.client_encoding=o.query.encoding,a;a.host||(a.host=o.hostname);var u=o.pathname;if(!a.host&&u&&/^%2f/i.test(u)){var p=u.split("/");a.host=decodeURIComponent(p[0]),u=p.splice(1).join("/")}switch(u&&u.charAt(0)==="/"&&(u=u.slice(1)||null),a.database=u&&decodeURI(u),(a.ssl==="true"||a.ssl==="1")&&(a.ssl=!0),a.ssl==="0"&&(a.ssl=!1),(a.sslcert||a.sslkey||a.sslrootcert||a.sslmode)&&(a.ssl={}),a.sslcert&&(a.ssl.cert=r.readFileSync(a.sslcert).toString()),a.sslkey&&(a.ssl.key=r.readFileSync(a.sslkey).toString()),a.sslrootcert&&(a.ssl.ca=r.readFileSync(a.sslrootcert).toString()),a.sslmode){case"disable":{a.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{a.ssl.rejectUnauthorized=!1;break}}return a}P(i,"parse"),e.exports=i,i.parse=i}),k_=We((t,e)=>{"use strict";Pe();var n=(Une(),sn(X8)),r=xh(),i=Bne().parse,s=P(function(p,h,b){return b===void 0?b=je.env["PG"+p.toUpperCase()]:b===!1||(b=je.env[b]),h[p]||b||r[p]},"val"),o=P(function(){switch(je.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return r.ssl},"readSSLConfigFromEnvironment"),a=P(function(p){return"'"+(""+p).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=P(function(p,h,b){var y=h[b];y!=null&&p.push(b+"="+a(y))},"add"),l=class{constructor(h){h=typeof h=="string"?i(h):h||{},h.connectionString&&(h=Object.assign({},h,i(h.connectionString))),this.user=s("user",h),this.database=s("database",h),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",h),10),this.host=s("host",h),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",h)}),this.binary=s("binary",h),this.options=s("options",h),this.ssl=typeof h.ssl>"u"?o():h.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",h),this.replication=s("replication",h),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",h,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",h,!1),this.statement_timeout=s("statement_timeout",h,!1),this.lock_timeout=s("lock_timeout",h,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",h,!1),this.query_timeout=s("query_timeout",h,!1),h.connectionTimeoutMillis===void 0?this.connect_timeout=je.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(h.connectionTimeoutMillis/1e3),h.keepAlive===!1?this.keepalives=0:h.keepAlive===!0&&(this.keepalives=1),typeof h.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(h.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(h){var b=[];c(b,this,"user"),c(b,this,"password"),c(b,this,"port"),c(b,this,"application_name"),c(b,this,"fallback_application_name"),c(b,this,"connect_timeout"),c(b,this,"options");var y=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(b,y,"sslmode"),c(b,y,"sslca"),c(b,y,"sslkey"),c(b,y,"sslcert"),c(b,y,"sslrootcert"),this.database&&b.push("dbname="+a(this.database)),this.replication&&b.push("replication="+a(this.replication)),this.host&&b.push("host="+a(this.host)),this.isDomainSocket)return h(null,b.join(" "));this.client_encoding&&b.push("client_encoding="+a(this.client_encoding)),n.lookup(this.host,function(g,_){return g?h(g,null):(b.push("hostaddr="+a(_)),h(null,b.join(" ")))})}};P(l,"ConnectionParameters");var u=l;e.exports=u}),$ne=We((t,e)=>{"use strict";Pe();var n=_h(),r=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(a,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=a==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(a){var c;a.text?c=r.exec(a.text):c=r.exec(a.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(a){for(var c=new Array(a.length),l=0,u=a.length;l<u;l++){var p=a[l];p!==null?c[l]=this._parsers[l](p):c[l]=null}return c}parseRow(a){for(var c={},l=0,u=a.length;l<u;l++){var p=a[l],h=this.fields[l].name;p!==null?c[h]=this._parsers[l](p):c[h]=null}return c}addRow(a){this.rows.push(a)}addFields(a){this.fields=a,this.fields.length&&(this._parsers=new Array(a.length));for(var c=0;c<a.length;c++){var l=a[c];this._types?this._parsers[c]=this._types.getTypeParser(l.dataTypeID,l.format||"text"):this._parsers[c]=n.getTypeParser(l.dataTypeID,l.format||"text")}}};P(i,"Result");var s=i;e.exports=s}),Gne=We((t,e)=>{"use strict";Pe();var{EventEmitter:n}=Do(),r=$ne(),i=Sh(),s=class extends n{constructor(c,l,u){super(),c=i.normalizeQueryConfig(c,l,u),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,je.domain&&c.callback&&(this.callback=je.domain.bind(c.callback)),this._result=new r(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new r(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let l;if(!this._canceledDueToError){try{l=this._result.parseRow(c.fields)}catch(u){this._canceledDueToError=u;return}this.emit("row",l,this._result),this._accumulateRows&&this._result.addRow(l)}}handleCommandComplete(c,l){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&l.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,l){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(l){je.nextTick(()=>{throw l})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let l=c.parsedStatements[this.name];return this.text&&l&&this.text!==l?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,l){c.execute({portal:this.portal,rows:l}),l?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(l){this.handleError(l,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,l){}};P(s,"Query");var o=s;e.exports=o}),n4={};Gr(n4,{Socket:()=>Ec,isIP:()=>r4});function r4(t){return 0}var N8,w_,Wu,Ec,R_=zn(()=>{"use strict";Pe(),N8=Sc(Do(),1),P(r4,"isIP"),w_=/^[^.]+\./,Wu=class qe extends N8.EventEmitter{constructor(){super(...arguments),$e(this,"opts",{}),$e(this,"connecting",!1),$e(this,"pending",!0),$e(this,"writable",!0),$e(this,"encrypted",!1),$e(this,"authorized",!1),$e(this,"destroyed",!1),$e(this,"ws",null),$e(this,"writeBuffer"),$e(this,"tlsState",0),$e(this,"tlsRead"),$e(this,"tlsWrite")}static get poolQueryViaFetch(){return qe.opts.poolQueryViaFetch??qe.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){qe.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return qe.opts.fetchEndpoint??qe.defaults.fetchEndpoint}static set fetchEndpoint(e){qe.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return qe.opts.fetchFunction??qe.defaults.fetchFunction}static set fetchFunction(e){qe.opts.fetchFunction=e}static get webSocketConstructor(){return qe.opts.webSocketConstructor??qe.defaults.webSocketConstructor}static set webSocketConstructor(e){qe.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??qe.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return qe.opts.wsProxy??qe.defaults.wsProxy}static set wsProxy(e){qe.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??qe.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return qe.opts.coalesceWrites??qe.defaults.coalesceWrites}static set coalesceWrites(e){qe.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??qe.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return qe.opts.useSecureWebSocket??qe.defaults.useSecureWebSocket}static set useSecureWebSocket(e){qe.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??qe.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return qe.opts.forceDisablePgSSL??qe.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){qe.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??qe.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return qe.opts.disableSNI??qe.defaults.disableSNI}static set disableSNI(e){qe.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??qe.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return qe.opts.pipelineConnect??qe.defaults.pipelineConnect}static set pipelineConnect(e){qe.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??qe.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return qe.opts.subtls??qe.defaults.subtls}static set subtls(e){qe.opts.subtls=e}get subtls(){return this.opts.subtls??qe.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return qe.opts.pipelineTLS??qe.defaults.pipelineTLS}static set pipelineTLS(e){qe.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??qe.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return qe.opts.rootCerts??qe.defaults.rootCerts}static set rootCerts(e){qe.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??qe.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,n){let r=this.wsProxy;if(r===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof r=="function"?r(e,n):`${r}?address=${e}:${n}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,n,r){this.connecting=!0,r&&this.once("connect",r);let i=P(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=P((a,c=!1)=>{a.binaryType="arraybuffer",a.addEventListener("error",l=>{this.emit("error",l),this.emit("close")}),a.addEventListener("message",l=>{if(this.tlsState===0){let u=Ue.from(l.data);this.emit("data",u)}}),a.addEventListener("close",()=>{this.emit("close")}),c?i():a.addEventListener("open",i)},"configureWebSocket"),o;try{o=this.wsProxyAddrForHost(n,typeof e=="string"?parseInt(e,10):e)}catch(a){this.emit("error",a),this.emit("close");return}try{let a=(this.useSecureWebSocket?"wss:":"ws:")+"//"+o;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(a),s(this.ws);else try{this.ws=new WebSocket(a),s(this.ws)}catch{this.ws=new __unstable_WebSocket(a),s(this.ws)}}catch(a){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+o;fetch(c,{headers:{Upgrade:"websocket"}}).then(l=>{if(this.ws=l.webSocket,this.ws==null)throw a;this.ws.accept(),s(this.ws,!0)}).catch(l=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${l.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let n=this.subtls.TrustedCert.fromPEM(this.rootCerts),r=new this.subtls.WebSocketReadQueue(this.ws),i=r.read.bind(r),s=this.rawWrite.bind(this),[o,a]=await this.subtls.startTls(e,n,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=o,this.tlsWrite=a,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let n=Ue.from(e);this.emit("data",n)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let n=new Uint8Array(this.writeBuffer.length+e.length);n.set(this.writeBuffer),n.set(e,this.writeBuffer.length),this.writeBuffer=n}}write(e,n="utf8",r=i=>{}){return e.length===0?(r(),!0):(typeof e=="string"&&(e=Ue.from(e,n)),this.tlsState===0?(this.rawWrite(e),r()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,n,r)}):(this.tlsWrite(e),r()),!0)}end(e=Ue.alloc(0),n="utf8",r=()=>{}){return this.write(e,n,()=>{this.ws.close(),r()}),this}destroy(){return this.destroyed=!0,this.end()}},P(Wu,"Socket"),$e(Wu,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:P((t,e,n)=>{let r;return n?.jwtAuth?r=t.replace(w_,"apiauth."):r=t.replace(w_,"api."),"https://"+r+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:P(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),$e(Wu,"opts",{}),Ec=Wu}),i4=We(t=>{"use strict";Pe(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(Q,ce,fe){super(Q),this.length=ce,this.name=fe}};P(e,"DatabaseError");var n=e;t.DatabaseError=n;var r=class{constructor(Q,ce){this.length=Q,this.chunk=ce,this.name="copyData"}};P(r,"CopyDataMessage");var i=r;t.CopyDataMessage=i;var s=class{constructor(Q,ce,fe,me){this.length=Q,this.name=ce,this.binary=fe,this.columnTypes=new Array(me)}};P(s,"CopyResponse");var o=s;t.CopyResponse=o;var a=class{constructor(Q,ce,fe,me,Me,Re,it){this.name=Q,this.tableID=ce,this.columnID=fe,this.dataTypeID=me,this.dataTypeSize=Me,this.dataTypeModifier=Re,this.format=it}};P(a,"Field");var c=a;t.Field=c;var l=class{constructor(Q,ce){this.length=Q,this.fieldCount=ce,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};P(l,"RowDescriptionMessage");var u=l;t.RowDescriptionMessage=u;var p=class{constructor(Q,ce){this.length=Q,this.parameterCount=ce,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};P(p,"ParameterDescriptionMessage");var h=p;t.ParameterDescriptionMessage=h;var b=class{constructor(Q,ce,fe){this.length=Q,this.parameterName=ce,this.parameterValue=fe,this.name="parameterStatus"}};P(b,"ParameterStatusMessage");var y=b;t.ParameterStatusMessage=y;var g=class{constructor(Q,ce){this.length=Q,this.salt=ce,this.name="authenticationMD5Password"}};P(g,"AuthenticationMD5Password");var _=g;t.AuthenticationMD5Password=_;var x=class{constructor(Q,ce,fe){this.length=Q,this.processID=ce,this.secretKey=fe,this.name="backendKeyData"}};P(x,"BackendKeyDataMessage");var C=x;t.BackendKeyDataMessage=C;var T=class{constructor(Q,ce,fe,me){this.length=Q,this.processId=ce,this.channel=fe,this.payload=me,this.name="notification"}};P(T,"NotificationResponseMessage");var N=T;t.NotificationResponseMessage=N;var D=class{constructor(Q,ce){this.length=Q,this.status=ce,this.name="readyForQuery"}};P(D,"ReadyForQueryMessage");var A=D;t.ReadyForQueryMessage=A;var R=class{constructor(Q,ce){this.length=Q,this.text=ce,this.name="commandComplete"}};P(R,"CommandCompleteMessage");var q=R;t.CommandCompleteMessage=q;var k=class{constructor(Q,ce){this.length=Q,this.fields=ce,this.name="dataRow",this.fieldCount=ce.length}};P(k,"DataRowMessage");var z=k;t.DataRowMessage=z;var V=class{constructor(Q,ce){this.length=Q,this.message=ce,this.name="notice"}};P(V,"NoticeMessage");var re=V;t.NoticeMessage=re}),Hne=We(t=>{"use strict";Pe(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=Ue.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var o=this.buffer,a=o.length+(o.length>>1)+i;this.buffer=Ue.allocUnsafe(a),o.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=Ue.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=Ue.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=Ue.allocUnsafe(this.size),s}};P(e,"Writer");var n=e;t.Writer=n}),zne=We(t=>{"use strict";Pe(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=Hne(),n=new e.Writer,r=P(Q=>{n.addInt16(3).addInt16(0);for(let me of Object.keys(Q))n.addCString(me).addCString(Q[me]);n.addCString("client_encoding").addCString("UTF8");var ce=n.addCString("").flush(),fe=ce.length+4;return new e.Writer().addInt32(fe).add(ce).flush()},"startup"),i=P(()=>{let Q=Ue.allocUnsafe(8);return Q.writeInt32BE(8,0),Q.writeInt32BE(80877103,4),Q},"requestSsl"),s=P(Q=>n.addCString(Q).flush(112),"password"),o=P(function(Q,ce){return n.addCString(Q).addInt32(Ue.byteLength(ce)).addString(ce),n.flush(112)},"sendSASLInitialResponseMessage"),a=P(function(Q){return n.addString(Q).flush(112)},"sendSCRAMClientFinalMessage"),c=P(Q=>n.addCString(Q).flush(81),"query"),l=[],u=P(Q=>{let ce=Q.name||"";ce.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",ce,ce.length),console.error("This can cause conflicts and silent errors executing queries"));let fe=Q.types||l;for(var me=fe.length,Me=n.addCString(ce).addCString(Q.text).addInt16(me),Re=0;Re<me;Re++)Me.addInt32(fe[Re]);return n.flush(80)},"parse"),p=new e.Writer,h=P(function(Q,ce){for(let fe=0;fe<Q.length;fe++){let me=ce?ce(Q[fe],fe):Q[fe];me==null?(n.addInt16(0),p.addInt32(-1)):me instanceof Ue?(n.addInt16(1),p.addInt32(me.length),p.add(me)):(n.addInt16(0),p.addInt32(Ue.byteLength(me)),p.addString(me))}},"writeValues"),b=P((Q={})=>{let ce=Q.portal||"",fe=Q.statement||"",me=Q.binary||!1,Me=Q.values||l,Re=Me.length;return n.addCString(ce).addCString(fe),n.addInt16(Re),h(Me,Q.valueMapper),n.addInt16(Re),n.add(p.flush()),n.addInt16(me?1:0),n.flush(66)},"bind"),y=Ue.from([69,0,0,0,9,0,0,0,0,0]),g=P(Q=>{if(!Q||!Q.portal&&!Q.rows)return y;let ce=Q.portal||"",fe=Q.rows||0,me=Ue.byteLength(ce),Me=4+me+1+4,Re=Ue.allocUnsafe(1+Me);return Re[0]=69,Re.writeInt32BE(Me,1),Re.write(ce,5,"utf-8"),Re[me+5]=0,Re.writeUInt32BE(fe,Re.length-4),Re},"execute"),_=P((Q,ce)=>{let fe=Ue.allocUnsafe(16);return fe.writeInt32BE(16,0),fe.writeInt16BE(1234,4),fe.writeInt16BE(5678,6),fe.writeInt32BE(Q,8),fe.writeInt32BE(ce,12),fe},"cancel"),x=P((Q,ce)=>{let fe=4+Ue.byteLength(ce)+1,me=Ue.allocUnsafe(1+fe);return me[0]=Q,me.writeInt32BE(fe,1),me.write(ce,5,"utf-8"),me[fe]=0,me},"cstringMessage"),C=n.addCString("P").flush(68),T=n.addCString("S").flush(68),N=P(Q=>Q.name?x(68,`${Q.type}${Q.name||""}`):Q.type==="P"?C:T,"describe"),D=P(Q=>{let ce=`${Q.type}${Q.name||""}`;return x(67,ce)},"close"),A=P(Q=>n.add(Q).flush(100),"copyData"),R=P(Q=>x(102,Q),"copyFail"),q=P(Q=>Ue.from([Q,0,0,0,4]),"codeOnlyBuffer"),k=q(72),z=q(83),V=q(88),re=q(99),ae={startup:r,password:s,requestSsl:i,sendSASLInitialResponseMessage:o,sendSCRAMClientFinalMessage:a,query:c,parse:u,bind:b,execute:g,describe:N,close:D,flush:P(()=>k,"flush"),sync:P(()=>z,"sync"),end:P(()=>V,"end"),copyData:A,copyDone:P(()=>re,"copyDone"),copyFail:R,cancel:_};t.serialize=ae}),Vne=We(t=>{"use strict";Pe(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=Ue.allocUnsafe(0),n=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,o){this.offset=s,this.buffer=o}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let o=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,o}cstring(){let s=this.offset,o=s;for(;this.buffer[o++]!==0;);return this.offset=o,this.buffer.toString(this.encoding,s,o-1)}bytes(s){let o=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,o}};P(n,"BufferReader");var r=n;t.BufferReader=r}),jne=We(t=>{"use strict";Pe(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=i4(),n=Vne(),r=1,i=4,s=r+i,o=Ue.allocUnsafe(0),a=class{constructor(u){if(this.buffer=o,this.bufferLength=0,this.bufferOffset=0,this.reader=new n.BufferReader,u?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=u?.mode||"text"}parse(u,p){this.mergeBuffer(u);let h=this.bufferOffset+this.bufferLength,b=this.bufferOffset;for(;b+s<=h;){let y=this.buffer[b],g=this.buffer.readUInt32BE(b+r),_=r+g;if(_+b<=h){let x=this.handlePacket(b+s,y,g,this.buffer);p(x),b+=_}else break}b===h?(this.buffer=o,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=h-b,this.bufferOffset=b)}mergeBuffer(u){if(this.bufferLength>0){let p=this.bufferLength+u.byteLength;if(p+this.bufferOffset>this.buffer.byteLength){let h;if(p<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)h=this.buffer;else{let b=this.buffer.byteLength*2;for(;p>=b;)b*=2;h=Ue.allocUnsafe(b)}this.buffer.copy(h,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=h,this.bufferOffset=0}u.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=p}else this.buffer=u,this.bufferOffset=0,this.bufferLength=u.byteLength}handlePacket(u,p,h,b){switch(p){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(u,h,b);case 67:return this.parseCommandCompleteMessage(u,h,b);case 90:return this.parseReadyForQueryMessage(u,h,b);case 65:return this.parseNotificationMessage(u,h,b);case 82:return this.parseAuthenticationResponse(u,h,b);case 83:return this.parseParameterStatusMessage(u,h,b);case 75:return this.parseBackendKeyData(u,h,b);case 69:return this.parseErrorMessage(u,h,b,"error");case 78:return this.parseErrorMessage(u,h,b,"notice");case 84:return this.parseRowDescriptionMessage(u,h,b);case 116:return this.parseParameterDescriptionMessage(u,h,b);case 71:return this.parseCopyInMessage(u,h,b);case 72:return this.parseCopyOutMessage(u,h,b);case 100:return this.parseCopyData(u,h,b);default:return new e.DatabaseError("received invalid response: "+p.toString(16),h,"error")}}parseReadyForQueryMessage(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.string(1);return new e.ReadyForQueryMessage(p,b)}parseCommandCompleteMessage(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.cstring();return new e.CommandCompleteMessage(p,b)}parseCopyData(u,p,h){let b=h.slice(u,u+(p-4));return new e.CopyDataMessage(p,b)}parseCopyInMessage(u,p,h){return this.parseCopyMessage(u,p,h,"copyInResponse")}parseCopyOutMessage(u,p,h){return this.parseCopyMessage(u,p,h,"copyOutResponse")}parseCopyMessage(u,p,h,b){this.reader.setBuffer(u,h);let y=this.reader.byte()!==0,g=this.reader.int16(),_=new e.CopyResponse(p,b,y,g);for(let x=0;x<g;x++)_.columnTypes[x]=this.reader.int16();return _}parseNotificationMessage(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.int32(),y=this.reader.cstring(),g=this.reader.cstring();return new e.NotificationResponseMessage(p,b,y,g)}parseRowDescriptionMessage(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.int16(),y=new e.RowDescriptionMessage(p,b);for(let g=0;g<b;g++)y.fields[g]=this.parseField();return y}parseField(){let u=this.reader.cstring(),p=this.reader.int32(),h=this.reader.int16(),b=this.reader.int32(),y=this.reader.int16(),g=this.reader.int32(),_=this.reader.int16()===0?"text":"binary";return new e.Field(u,p,h,b,y,g,_)}parseParameterDescriptionMessage(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.int16(),y=new e.ParameterDescriptionMessage(p,b);for(let g=0;g<b;g++)y.dataTypeIDs[g]=this.reader.int32();return y}parseDataRowMessage(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.int16(),y=new Array(b);for(let g=0;g<b;g++){let _=this.reader.int32();y[g]=_===-1?null:this.reader.string(_)}return new e.DataRowMessage(p,y)}parseParameterStatusMessage(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.cstring(),y=this.reader.cstring();return new e.ParameterStatusMessage(p,b,y)}parseBackendKeyData(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.int32(),y=this.reader.int32();return new e.BackendKeyDataMessage(p,b,y)}parseAuthenticationResponse(u,p,h){this.reader.setBuffer(u,h);let b=this.reader.int32(),y={name:"authenticationOk",length:p};switch(b){case 0:break;case 3:y.length===8&&(y.name="authenticationCleartextPassword");break;case 5:if(y.length===12){y.name="authenticationMD5Password";let _=this.reader.bytes(4);return new e.AuthenticationMD5Password(p,_)}break;case 10:y.name="authenticationSASL",y.mechanisms=[];let g;do g=this.reader.cstring(),g&&y.mechanisms.push(g);while(g);break;case 11:y.name="authenticationSASLContinue",y.data=this.reader.string(p-8);break;case 12:y.name="authenticationSASLFinal",y.data=this.reader.string(p-8);break;default:throw new Error("Unknown authenticationOk message type "+b)}return y}parseErrorMessage(u,p,h,b){this.reader.setBuffer(u,h);let y={},g=this.reader.string(1);for(;g!=="\0";)y[g]=this.reader.cstring(),g=this.reader.string(1);let _=y.M,x=b==="notice"?new e.NoticeMessage(p,_):new e.DatabaseError(_,p,b);return x.severity=y.S,x.code=y.C,x.detail=y.D,x.hint=y.H,x.position=y.P,x.internalPosition=y.p,x.internalQuery=y.q,x.where=y.W,x.schema=y.s,x.table=y.t,x.column=y.c,x.dataType=y.d,x.constraint=y.n,x.file=y.F,x.line=y.L,x.routine=y.R,x}};P(a,"Parser");var c=a;t.Parser=c}),s4=We(t=>{"use strict";Pe(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=i4();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:P(function(){return e.DatabaseError},"get")});var n=zne();Object.defineProperty(t,"serialize",{enumerable:!0,get:P(function(){return n.serialize},"get")});var r=jne();function i(s,o){let a=new r.Parser;return s.on("data",c=>a.parse(c,o)),new Promise(c=>s.on("end",()=>c()))}P(i,"parse"),t.parse=i}),o4={};Gr(o4,{connect:()=>a4});function a4({socket:t,servername:e}){return t.startTls(e),t}var Wne=zn(()=>{"use strict";Pe(),P(a4,"connect")}),c4=We((t,e)=>{"use strict";Pe();var n=(R_(),sn(n4)),r=Do().EventEmitter,{parse:i,serialize:s}=s4(),o=s.flush(),a=s.sync(),c=s.end(),l=class extends r{constructor(h){super(),h=h||{},this.stream=h.stream||new n.Socket,this._keepAlive=h.keepAlive,this._keepAliveInitialDelayMillis=h.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=h.ssl||!1,this._ending=!1,this._emitMessage=!1;var b=this;this.on("newListener",function(y){y==="message"&&(b._emitMessage=!0)})}connect(h,b){var y=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(h,b),this.stream.once("connect",function(){y._keepAlive&&y.stream.setKeepAlive(!0,y._keepAliveInitialDelayMillis),y.emit("connect")});let g=P(function(_){y._ending&&(_.code==="ECONNRESET"||_.code==="EPIPE")||y.emit("error",_)},"reportStreamError");if(this.stream.on("error",g),this.stream.on("close",function(){y.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(_){var x=_.toString("utf8");switch(x){case"S":break;case"N":return y.stream.end(),y.emit("error",new Error("The server does not support SSL connections"));default:return y.stream.end(),y.emit("error",new Error("There was an error establishing an SSL connection"))}var C=(Wne(),sn(o4));let T={socket:y.stream};y.ssl!==!0&&(Object.assign(T,y.ssl),"key"in y.ssl&&(T.key=y.ssl.key)),n.isIP(b)===0&&(T.servername=b);try{y.stream=C.connect(T)}catch(N){return y.emit("error",N)}y.attachListeners(y.stream),y.stream.on("error",g),y.emit("sslconnect")})}attachListeners(h){h.on("end",()=>{this.emit("end")}),i(h,b=>{var y=b.name==="error"?"errorMessage":b.name;this._emitMessage&&this.emit("message",b),this.emit(y,b)})}requestSsl(){this.stream.write(s.requestSsl())}startup(h){this.stream.write(s.startup(h))}cancel(h,b){this._send(s.cancel(h,b))}password(h){this._send(s.password(h))}sendSASLInitialResponseMessage(h,b){this._send(s.sendSASLInitialResponseMessage(h,b))}sendSCRAMClientFinalMessage(h){this._send(s.sendSCRAMClientFinalMessage(h))}_send(h){return this.stream.writable?this.stream.write(h):!1}query(h){this._send(s.query(h))}parse(h){this._send(s.parse(h))}bind(h){this._send(s.bind(h))}execute(h){this._send(s.execute(h))}flush(){this.stream.writable&&this.stream.write(o)}sync(){this._ending=!0,this._send(o),this._send(a)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(h){this._send(s.close(h))}describe(h){this._send(s.describe(h))}sendCopyFromChunk(h){this._send(s.copyData(h))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(h){this._send(s.copyFail(h))}};P(l,"Connection");var u=l;e.exports=u}),Qne=We((t,e)=>{"use strict";Pe();var n=Do().EventEmitter,r=(wh(),sn(Ju)),i=Sh(),s=One(),o=Fne(),a=I_(),c=k_(),l=Gne(),u=xh(),p=c4(),h=class extends n{constructor(g){super(),this.connectionParameters=new c(g),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var _=g||{};this._Promise=_.Promise||bh.Promise,this._types=new a(_.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=_.connection||new p({stream:_.stream,ssl:this.connectionParameters.ssl,keepAlive:_.keepAlive||!1,keepAliveInitialDelayMillis:_.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=_.binary||u.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=_.connectionTimeoutMillis||0}_errorAllQueries(g){let _=P(x=>{je.nextTick(()=>{x.handleError(g,this.connection)})},"enqueueError");this.activeQuery&&(_(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(_),this.queryQueue.length=0}_connect(g){var _=this,x=this.connection;if(this._connectionCallback=g,this._connecting||this._connected){let C=new Error("Client has already been connected. You cannot reuse a client.");je.nextTick(()=>{g(C)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{x._ending=!0,x.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?x.connect(this.host+"/.s.PGSQL."+this.port):x.connect(this.port,this.host),x.on("connect",function(){_.ssl?x.requestSsl():x.startup(_.getStartupConf())}),x.on("sslconnect",function(){x.startup(_.getStartupConf())}),this._attachListeners(x),x.once("end",()=>{let C=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(C),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(C):this._handleErrorEvent(C):this._connectionError||this._handleErrorEvent(C)),je.nextTick(()=>{this.emit("end")})})}connect(g){if(g){this._connect(g);return}return new this._Promise((_,x)=>{this._connect(C=>{C?x(C):_()})})}_attachListeners(g){g.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),g.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),g.on("authenticationSASL",this._handleAuthSASL.bind(this)),g.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),g.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),g.on("backendKeyData",this._handleBackendKeyData.bind(this)),g.on("error",this._handleErrorEvent.bind(this)),g.on("errorMessage",this._handleErrorMessage.bind(this)),g.on("readyForQuery",this._handleReadyForQuery.bind(this)),g.on("notice",this._handleNotice.bind(this)),g.on("rowDescription",this._handleRowDescription.bind(this)),g.on("dataRow",this._handleDataRow.bind(this)),g.on("portalSuspended",this._handlePortalSuspended.bind(this)),g.on("emptyQuery",this._handleEmptyQuery.bind(this)),g.on("commandComplete",this._handleCommandComplete.bind(this)),g.on("parseComplete",this._handleParseComplete.bind(this)),g.on("copyInResponse",this._handleCopyInResponse.bind(this)),g.on("copyData",this._handleCopyData.bind(this)),g.on("notification",this._handleNotification.bind(this))}_checkPgPass(g){let _=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(x=>{if(x!==void 0){if(typeof x!="string"){_.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=x}else this.connectionParameters.password=this.password=null;g()}).catch(x=>{_.emit("error",x)}):this.password!==null?g():o(this.connectionParameters,x=>{x!==void 0&&(this.connectionParameters.password=this.password=x),g()})}_handleAuthCleartextPassword(g){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(g){this._checkPgPass(()=>{let _=i.postgresMd5PasswordHash(this.user,this.password,g.salt);this.connection.password(_)})}_handleAuthSASL(g){this._checkPgPass(()=>{this.saslSession=s.startSession(g.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(g){s.continueSession(this.saslSession,this.password,g.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(g){s.finalizeSession(this.saslSession,g.data),this.saslSession=null}_handleBackendKeyData(g){this.processID=g.processID,this.secretKey=g.secretKey}_handleReadyForQuery(g){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:_}=this;this.activeQuery=null,this.readyForQuery=!0,_&&_.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(g){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(g);this.emit("error",g)}}_handleErrorEvent(g){if(this._connecting)return this._handleErrorWhileConnecting(g);this._queryable=!1,this._errorAllQueries(g),this.emit("error",g)}_handleErrorMessage(g){if(this._connecting)return this._handleErrorWhileConnecting(g);let _=this.activeQuery;if(!_){this._handleErrorEvent(g);return}this.activeQuery=null,_.handleError(g,this.connection)}_handleRowDescription(g){this.activeQuery.handleRowDescription(g)}_handleDataRow(g){this.activeQuery.handleDataRow(g)}_handlePortalSuspended(g){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(g){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(g){this.activeQuery.handleCommandComplete(g,this.connection)}_handleParseComplete(g){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(g){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(g){this.activeQuery.handleCopyData(g,this.connection)}_handleNotification(g){this.emit("notification",g)}_handleNotice(g){this.emit("notice",g)}getStartupConf(){var g=this.connectionParameters,_={user:g.user,database:g.database},x=g.application_name||g.fallback_application_name;return x&&(_.application_name=x),g.replication&&(_.replication=""+g.replication),g.statement_timeout&&(_.statement_timeout=String(parseInt(g.statement_timeout,10))),g.lock_timeout&&(_.lock_timeout=String(parseInt(g.lock_timeout,10))),g.idle_in_transaction_session_timeout&&(_.idle_in_transaction_session_timeout=String(parseInt(g.idle_in_transaction_session_timeout,10))),g.options&&(_.options=g.options),_}cancel(g,_){if(g.activeQuery===_){var x=this.connection;this.host&&this.host.indexOf("/")===0?x.connect(this.host+"/.s.PGSQL."+this.port):x.connect(this.port,this.host),x.on("connect",function(){x.cancel(g.processID,g.secretKey)})}else g.queryQueue.indexOf(_)!==-1&&g.queryQueue.splice(g.queryQueue.indexOf(_),1)}setTypeParser(g,_,x){return this._types.setTypeParser(g,_,x)}getTypeParser(g,_){return this._types.getTypeParser(g,_)}escapeIdentifier(g){return'"'+g.replace(/"/g,'""')+'"'}escapeLiteral(g){for(var _=!1,x="'",C=0;C<g.length;C++){var T=g[C];T==="'"?x+=T+T:T==="\\"?(x+=T+T,_=!0):x+=T}return x+="'",_===!0&&(x=" E"+x),x}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let g=this.activeQuery.submit(this.connection);g&&je.nextTick(()=>{this.activeQuery.handleError(g,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(g,_,x){var C,T,N,D,A;if(g==null)throw new TypeError("Client was passed a null or undefined query");return typeof g.submit=="function"?(N=g.query_timeout||this.connectionParameters.query_timeout,T=C=g,typeof _=="function"&&(C.callback=C.callback||_)):(N=this.connectionParameters.query_timeout,C=new l(g,_,x),C.callback||(T=new this._Promise((R,q)=>{C.callback=(k,z)=>k?q(k):R(z)}))),N&&(A=C.callback,D=setTimeout(()=>{var R=new Error("Query read timeout");je.nextTick(()=>{C.handleError(R,this.connection)}),A(R),C.callback=()=>{};var q=this.queryQueue.indexOf(C);q>-1&&this.queryQueue.splice(q,1),this._pulseQueryQueue()},N),C.callback=(R,q)=>{clearTimeout(D),A(R,q)}),this.binary&&!C.binary&&(C.binary=!0),C._result&&!C._result._types&&(C._result._types=this._types),this._queryable?this._ending?(je.nextTick(()=>{C.handleError(new Error("Client was closed and is not queryable"),this.connection)}),T):(this.queryQueue.push(C),this._pulseQueryQueue(),T):(je.nextTick(()=>{C.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),T)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(g){if(this._ending=!0,!this.connection._connecting)if(g)g();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),g)this.connection.once("end",g);else return new this._Promise(_=>{this.connection.once("end",_)})}};P(h,"Client");var b=h;b.Query=l,e.exports=b}),Jne=We((t,e)=>{"use strict";Pe();var n=Do().EventEmitter,r=P(function(){},"NOOP"),i=P((y,g)=>{let _=y.findIndex(g);return _===-1?void 0:y.splice(_,1)[0]},"removeWhere"),s=class{constructor(g,_,x){this.client=g,this.idleListener=_,this.timeoutId=x}};P(s,"IdleItem");var o=s,a=class{constructor(g){this.callback=g}};P(a,"PendingItem");var c=a;function l(){throw new Error("Release called on client which has already been released to the pool.")}P(l,"throwOnDoubleRelease");function u(y,g){if(g)return{callback:g,result:void 0};let _,x,C=P(function(N,D){N?_(N):x(D)},"cb"),T=new y(function(N,D){x=N,_=D}).catch(N=>{throw Error.captureStackTrace(N),N});return{callback:C,result:T}}P(u,"promisify");function p(y,g){return P(function _(x){x.client=g,g.removeListener("error",_),g.on("error",()=>{y.log("additional client error after disconnection due to error",x)}),y._remove(g),y.emit("error",x,g)},"idleListener")}P(p,"makeIdleListener");var h=class extends n{constructor(g,_){super(),this.options=Object.assign({},g),g!=null&&"password"in g&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:g.password}),g!=null&&g.ssl&&g.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||_||N_().Client,this.Promise=this.options.Promise||bh.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(_=>{this._remove(_.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let g=this._pendingQueue.shift();if(this._idle.length){let _=this._idle.pop();clearTimeout(_.timeoutId);let x=_.client;x.ref&&x.ref();let C=_.idleListener;return this._acquireClient(x,g,C,!1)}if(!this._isFull())return this.newClient(g);throw new Error("unexpected condition")}_remove(g){let _=i(this._idle,x=>x.client===g);_!==void 0&&clearTimeout(_.timeoutId),this._clients=this._clients.filter(x=>x!==g),g.end(),this.emit("remove",g)}connect(g){if(this.ending){let C=new Error("Cannot use a pool after calling end on the pool");return g?g(C):this.Promise.reject(C)}let _=u(this.Promise,g),x=_.result;if(this._isFull()||this._idle.length){if(this._idle.length&&je.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(_.callback)),x;let C=P((D,A,R)=>{clearTimeout(N),_.callback(D,A,R)},"queueCallback"),T=new c(C),N=setTimeout(()=>{i(this._pendingQueue,D=>D.callback===C),T.timedOut=!0,_.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(T),x}return this.newClient(new c(_.callback)),x}newClient(g){let _=new this.Client(this.options);this._clients.push(_);let x=p(this,_);this.log("checking client timeout");let C,T=!1;this.options.connectionTimeoutMillis&&(C=setTimeout(()=>{this.log("ending client due to timeout"),T=!0,_.connection?_.connection.stream.destroy():_.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),_.connect(N=>{if(C&&clearTimeout(C),_.on("error",x),N)this.log("client failed to connect",N),this._clients=this._clients.filter(D=>D!==_),T&&(N.message="Connection terminated due to connection timeout"),this._pulseQueue(),g.timedOut||g.callback(N,void 0,r);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let D=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(_),this._idle.findIndex(A=>A.client===_)!==-1&&this._acquireClient(_,new c((A,R,q)=>q()),x,!1)},this.options.maxLifetimeSeconds*1e3);D.unref(),_.once("end",()=>clearTimeout(D))}return this._acquireClient(_,g,x,!0)}})}_acquireClient(g,_,x,C){C&&this.emit("connect",g),this.emit("acquire",g),g.release=this._releaseOnce(g,x),g.removeListener("error",x),_.timedOut?C&&this.options.verify?this.options.verify(g,g.release):g.release():C&&this.options.verify?this.options.verify(g,T=>{if(T)return g.release(T),_.callback(T,void 0,r);_.callback(void 0,g,g.release)}):_.callback(void 0,g,g.release)}_releaseOnce(g,_){let x=!1;return C=>{x&&l(),x=!0,this._release(g,_,C)}}_release(g,_,x){if(g.on("error",_),g._poolUseCount=(g._poolUseCount||0)+1,this.emit("release",x,g),x||this.ending||!g._queryable||g._ending||g._poolUseCount>=this.options.maxUses){g._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(g),this._pulseQueue();return}if(this._expired.has(g)){this.log("remove expired client"),this._expired.delete(g),this._remove(g),this._pulseQueue();return}let C;this.options.idleTimeoutMillis&&(C=setTimeout(()=>{this.log("remove idle client"),this._remove(g)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&C.unref()),this.options.allowExitOnIdle&&g.unref(),this._idle.push(new o(g,_,C)),this._pulseQueue()}query(g,_,x){if(typeof g=="function"){let T=u(this.Promise,g);return S_(function(){return T.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),T.result}typeof _=="function"&&(x=_,_=void 0);let C=u(this.Promise,x);return x=C.callback,this.connect((T,N)=>{if(T)return x(T);let D=!1,A=P(R=>{D||(D=!0,N.release(R),x(R))},"onError");N.once("error",A),this.log("dispatching query");try{N.query(g,_,(R,q)=>{if(this.log("query dispatched"),N.removeListener("error",A),!D)return D=!0,N.release(R),R?x(R):x(void 0,q)})}catch(R){return N.release(R),x(R)}}),C.result}end(g){if(this.log("ending"),this.ending){let x=new Error("Called end on pool more than once");return g?g(x):this.Promise.reject(x)}this.ending=!0;let _=u(this.Promise,g);return this._endCallback=_.callback,this._pulseQueue(),_.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((g,_)=>g+(this._expired.has(_)?1:0),0)}get totalCount(){return this._clients.length}};P(h,"Pool");var b=h;e.exports=b}),l4={};Gr(l4,{default:()=>u4});var u4,Kne=zn(()=>{"use strict";Pe(),u4={}}),Yne=We((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),Xne=We((t,e)=>{"use strict";Pe();var n=Do().EventEmitter,r=(wh(),sn(Ju)),i=Sh(),s=e.exports=function(a,c,l){n.call(this),a=i.normalizeQueryConfig(a,c,l),this.text=a.text,this.values=a.values,this.name=a.name,this.callback=a.callback,this.state="new",this._arrayMode=a.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(u){u==="row"&&(this._emitRowEvents=!0)}.bind(this))};r.inherits(s,n);var o={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(a){var c=this.native.pq.resultErrorFields();if(c)for(var l in c){var u=o[l]||l;a[u]=c[l]}this.callback?this.callback(a):this.emit("error",a),this.state="error"},s.prototype.then=function(a,c){return this._getPromise().then(a,c)},s.prototype.catch=function(a){return this._getPromise().catch(a)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(a,c){this._once("end",a),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(a){this.state="running";var c=this;this.native=a.native,a.native.arrayMode=this._arrayMode;var l=P(function(h,b,y){if(a.native.arrayMode=!1,S_(function(){c.emit("_done")}),h)return c.handleError(h);c._emitRowEvents&&(y.length>1?b.forEach((g,_)=>{g.forEach(x=>{c.emit("row",x,y[_])})}):b.forEach(function(g){c.emit("row",g,y)})),c.state="end",c.emit("end",y),c.callback&&c.callback(null,y)},"after");if(je.domain&&(l=je.domain.bind(l)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var u=(this.values||[]).map(i.prepareValue);if(a.namedQueries[this.name]){if(this.text&&a.namedQueries[this.name]!==this.text){let h=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return l(h)}return a.native.execute(this.name,u,l)}return a.native.prepare(this.name,this.text,u.length,function(h){return h?l(h):(a.namedQueries[c.name]=c.text,c.native.execute(c.name,u,l))})}else if(this.values){if(!Array.isArray(this.values)){let h=new Error("Query values must be an array");return l(h)}var p=this.values.map(i.prepareValue);a.native.query(this.text,p,l)}else a.native.query(this.text,l)}}),Zne=We((t,e)=>{"use strict";Pe();var n=(Kne(),sn(l4)),r=I_(),i=Yne(),s=Do().EventEmitter,o=(wh(),sn(Ju)),a=k_(),c=Xne(),l=e.exports=function(u){s.call(this),u=u||{},this._Promise=u.Promise||bh.Promise,this._types=new r(u.types),this.native=new n({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var p=this.connectionParameters=new a(u);this.user=p.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),this.database=p.database,this.host=p.host,this.port=p.port,this.namedQueries={}};l.Query=c,o.inherits(l,s),l.prototype._errorAllQueries=function(u){let p=P(h=>{je.nextTick(()=>{h.native=this.native,h.handleError(u)})},"enqueueError");this._hasActiveQuery()&&(p(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(p),this._queryQueue.length=0},l.prototype._connect=function(u){var p=this;if(this._connecting){je.nextTick(()=>u(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(h,b){if(h)return u(h);p.native.connect(b,function(y){if(y)return p.native.end(),u(y);p._connected=!0,p.native.on("error",function(g){p._queryable=!1,p._errorAllQueries(g),p.emit("error",g)}),p.native.on("notification",function(g){p.emit("notification",{channel:g.relname,payload:g.extra})}),p.emit("connect"),p._pulseQueryQueue(!0),u()})})},l.prototype.connect=function(u){if(u){this._connect(u);return}return new this._Promise((p,h)=>{this._connect(b=>{b?h(b):p()})})},l.prototype.query=function(u,p,h){var b,y,g,_,x;if(u==null)throw new TypeError("Client was passed a null or undefined query");if(typeof u.submit=="function")g=u.query_timeout||this.connectionParameters.query_timeout,y=b=u,typeof p=="function"&&(u.callback=p);else if(g=this.connectionParameters.query_timeout,b=new c(u,p,h),!b.callback){let C,T;y=new this._Promise((N,D)=>{C=N,T=D}),b.callback=(N,D)=>N?T(N):C(D)}return g&&(x=b.callback,_=setTimeout(()=>{var C=new Error("Query read timeout");je.nextTick(()=>{b.handleError(C,this.connection)}),x(C),b.callback=()=>{};var T=this._queryQueue.indexOf(b);T>-1&&this._queryQueue.splice(T,1),this._pulseQueryQueue()},g),b.callback=(C,T)=>{clearTimeout(_),x(C,T)}),this._queryable?this._ending?(b.native=this.native,je.nextTick(()=>{b.handleError(new Error("Client was closed and is not queryable"))}),y):(this._queryQueue.push(b),this._pulseQueryQueue(),y):(b.native=this.native,je.nextTick(()=>{b.handleError(new Error("Client has encountered a connection error and is not queryable"))}),y)},l.prototype.end=function(u){var p=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,u));var h;return u||(h=new this._Promise(function(b,y){u=P(g=>g?y(g):b(),"cb")})),this.native.end(function(){p._errorAllQueries(new Error("Connection terminated")),je.nextTick(()=>{p.emit("end"),u&&u()})}),h},l.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},l.prototype._pulseQueryQueue=function(u){if(this._connected&&!this._hasActiveQuery()){var p=this._queryQueue.shift();if(!p){u||this.emit("drain");return}this._activeQuery=p,p.submit(this);var h=this;p.once("_done",function(){h._pulseQueryQueue()})}},l.prototype.cancel=function(u){this._activeQuery===u?this.native.cancel(function(){}):this._queryQueue.indexOf(u)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(u),1)},l.prototype.ref=function(){},l.prototype.unref=function(){},l.prototype.setTypeParser=function(u,p,h){return this._types.setTypeParser(u,p,h)},l.prototype.getTypeParser=function(u,p){return this._types.getTypeParser(u,p)}}),M8=We((t,e)=>{"use strict";Pe(),e.exports=Zne()}),N_=We((t,e)=>{"use strict";Pe();var n=Qne(),r=xh(),i=c4(),s=Jne(),{DatabaseError:o}=s4(),a=P(l=>{var u;return u=class extends s{constructor(p){super(p,l)}},P(u,"BoundPool"),u},"poolFactory"),c=P(function(l){this.defaults=r,this.Client=l,this.Query=this.Client.Query,this.Pool=a(this.Client),this._pools=[],this.Connection=i,this.types=_h(),this.DatabaseError=o},"PG");typeof je.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(M8()):(e.exports=new c(n),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var l=null;try{l=new c(M8())}catch(u){if(u.code!=="MODULE_NOT_FOUND")throw u}return Object.defineProperty(e.exports,"native",{value:l}),l}}))});Pe();var f4=Sc(N_());R_();Pe();R_();t4();var ere=Sc(Sh()),tre=Sc(I_());function p4(t){return t instanceof Ue?"\\x"+t.toString("hex"):t}P(p4,"encodeBuffersAsBytea");var d4=class h4 extends Error{constructor(e){super(e),$e(this,"name","NeonDbError"),$e(this,"severity"),$e(this,"code"),$e(this,"detail"),$e(this,"hint"),$e(this,"position"),$e(this,"internalPosition"),$e(this,"internalQuery"),$e(this,"where"),$e(this,"schema"),$e(this,"table"),$e(this,"column"),$e(this,"dataType"),$e(this,"constraint"),$e(this,"file"),$e(this,"line"),$e(this,"routine"),$e(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,h4)}};P(d4,"NeonDbError");var _c=d4,O8="transaction() expects an array of queries, or a function returning an array of queries",nre=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function m4(t,{arrayMode:e,fullResults:n,fetchOptions:r,isolationLevel:i,readOnly:s,deferrable:o,queryCallback:a,resultCallback:c,authToken:l}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let u;try{u=P_(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:p,username:h,hostname:b,port:y,pathname:g}=u;if(p!=="postgres:"&&p!=="postgresql:"||!h||!b||!g)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function _(C,...T){let N,D;if(typeof C=="string")N=C,D=T[1],T=T[0]??[];else{N="";for(let R=0;R<C.length;R++)N+=C[R],R<T.length&&(N+="$"+(R+1))}T=T.map(R=>p4((0,ere.prepareValue)(R)));let A={query:N,params:T};return a&&a(A),g4(x,A,D)}P(_,"resolve"),_.transaction=async(C,T)=>{if(typeof C=="function"&&(C=C(_)),!Array.isArray(C))throw new Error(O8);C.forEach(A=>{if(A[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(O8)});let N=C.map(A=>A.parameterizedQuery),D=C.map(A=>A.opts??{});return x(N,D,T)};async function x(C,T,N){let{fetchEndpoint:D,fetchFunction:A}=Ec,R=Array.isArray(C)?{queries:C}:C,q=r??{},k=e??!1,z=n??!1,V=i,re=s,ae=o;N!==void 0&&(N.fetchOptions!==void 0&&(q={...q,...N.fetchOptions}),N.arrayMode!==void 0&&(k=N.arrayMode),N.fullResults!==void 0&&(z=N.fullResults),N.isolationLevel!==void 0&&(V=N.isolationLevel),N.readOnly!==void 0&&(re=N.readOnly),N.deferrable!==void 0&&(ae=N.deferrable)),T!==void 0&&!Array.isArray(T)&&T.fetchOptions!==void 0&&(q={...q,...T.fetchOptions});let Q=l;!Array.isArray(T)&&T?.authToken!==void 0&&(Q=T.authToken);let ce=typeof D=="function"?D(b,y,{jwtAuth:Q!==void 0}):D,fe={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},me=await y4(Q);me&&(fe.Authorization=`Bearer ${me}`),Array.isArray(C)&&(V!==void 0&&(fe["Neon-Batch-Isolation-Level"]=V),re!==void 0&&(fe["Neon-Batch-Read-Only"]=String(re)),ae!==void 0&&(fe["Neon-Batch-Deferrable"]=String(ae)));let Me;try{Me=await(A??fetch)(ce,{method:"POST",body:JSON.stringify(R),headers:fe,...q})}catch(Re){let it=new _c(`Error connecting to database: ${Re.message}`);throw it.sourceError=Re,it}if(Me.ok){let Re=await Me.json();if(Array.isArray(C)){let it=Re.results;if(!Array.isArray(it))throw new _c("Neon internal error: unexpected result format");return it.map((Qe,ye)=>{let le=T[ye]??{},at=le.arrayMode??k,st=le.fullResults??z;return x_(Qe,{arrayMode:at,fullResults:st,parameterizedQuery:C[ye],resultCallback:c,types:le.types})})}else{let it=T??{},Qe=it.arrayMode??k,ye=it.fullResults??z;return x_(Re,{arrayMode:Qe,fullResults:ye,parameterizedQuery:C,resultCallback:c,types:it.types})}}else{let{status:Re}=Me;if(Re===400){let it=await Me.json(),Qe=new _c(it.message);for(let ye of nre)Qe[ye]=it[ye]??void 0;throw Qe}else{let it=await Me.text();throw new _c(`Server error (HTTP status ${Re}): ${it}`)}}}return P(x,"execute"),_}P(m4,"neon");function g4(t,e,n){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:n,then:P((r,i)=>t(e,n).then(r,i),"then"),catch:P(r=>t(e,n).catch(r),"catch"),finally:P(r=>t(e,n).finally(r),"finally")}}P(g4,"createNeonQueryPromise");function x_(t,{arrayMode:e,fullResults:n,parameterizedQuery:r,resultCallback:i,types:s}){let o=new tre.default(s),a=t.fields.map(u=>u.name),c=t.fields.map(u=>o.getTypeParser(u.dataTypeID)),l=e===!0?t.rows.map(u=>u.map((p,h)=>p===null?null:c[h](p))):t.rows.map(u=>Object.fromEntries(u.map((p,h)=>[a[h],p===null?null:c[h](p)])));return i&&i(r,t,l,{arrayMode:e,fullResults:n}),n?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=l,t._parsers=c,t._types=o,t):l}P(x_,"processQueryResult");async function y4(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let n=new _c("Error getting auth token.");throw e instanceof Error&&(n=new _c(`Error getting auth token: ${e.message}`)),n}}P(y4,"getAuthToken");var rre=Sc(k_()),Tc=Sc(N_()